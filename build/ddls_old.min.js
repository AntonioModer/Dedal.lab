'use strict';var DDLS={EPSILON:0.01,EPSILON_SQUARED:1E-4,SegmentID:0,ShapeID:0,EdgeID:0,FaceID:0,MeshID:0,ObjectID:0,VertexID:0,GraphID:0,GraphEdgeID:0,GraphNodeID:0};DDLS.sqrt=Math.sqrt;DDLS.cos=Math.cos;DDLS.sin=Math.sin;DDLS.atan2=Math.atan2;DDLS.round=Math.round;DDLS.pow=Math.pow;DDLS.max=Math.max;DDLS.random=Math.random;DDLS.lerp=function(a,b,c){return a+(b-a)*c};DDLS.randInRange=function(a,b){return DDLS.lerp(a,b,DDLS.random())};
DDLS.randInt=function(a,b,c){return 1*DDLS.lerp(a,b,DDLS.random()).toFixed(c||0)};DDLS.PI=3.141592653589793;DDLS.TwoPI=6.283185307179586;DDLS.PI90=0.5*DDLS.PI;DDLS.PI270=DDLS.PI+DDLS.PI90;DDLS.ToRad=DDLS.PI/180;DDLS.ToDeg=180/DDLS.PI;DDLS.NaN=Number.NaN;DDLS.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY;DDLS.POSITIVE_INFINITY=Number.POSITIVE_INFINITY;DDLS.isFinite=function(a){return isFinite(a)};DDLS.isNaN=function(a){return isNaN(a)};DDLS.Log=function(a){console.log(a)};DDLS.Debug={};
DDLS.Debug.assertTrue=function(a,b,c){a||console.error(c.fileName+":"+c.lineNumber+": Expected true but was false! "+(null!=b?b:""))};DDLS.Debug.assertFalse=function(a,b,c){a&&console.error(c.fileName+":"+c.lineNumber+": Expected false but was true! "+(null!=b?b:""))};DDLS.Debug.assertEquals=function(a,b,c,d){b!=a&&console.error(d.fileName+":"+d.lineNumber+": Expected '"+DDLS.Std.string(a)+"' but was '"+DDLS.Std.string(b)+"' "+(null!=c?c:""))};DDLS.Debug.trace=function(a,b){console.log(a,b)};
DDLS.Overrides={};DDLS.Overrides.cca=function(a,b){var c=a.charCodeAt(b);return c!=c?void 0:c};DDLS.Overrides.substr=function(a,b,c){if(null!=b&&0!=b&&null!=c&&0>c)return"";null==c&&(c=a.length);0>b?(b=a.length+b,0>b&&(b=0)):0>c&&(c=a.length+c-b);return a.substr(b,c)};DDLS.Overrides.indexOf=function(a,b,c){var d=a.length;0>c&&(c+=d,0>c&&(c=0));for(;c<d;){if(a[c]===b)return c;c++}return-1};Array.prototype.indexOf&&(DDLS.Overrides.indexOf=function(a,b,c){return Array.prototype.indexOf.call(a,b,c)});
DDLS.StringMap=function(){this.h={}};DDLS.StringMap.prototype={set:function(a,b){this.h[a]=b},get:function(a){return this.h[a]}};DDLS.Std={};DDLS.Std.string=function(a){return a.toString()};DDLS.Std.int=function(a){return a|0};DDLS.Std.parseInt=function(a){var b=parseInt(a,10);0!=b||120!=DDLS.Overrides.cca(a,1)&&88!=DDLS.Overrides.cca(a,1)||(b=parseInt(a));return isNaN(b)?null:b};DDLS.Std.parseFloat=function(a){return parseFloat(a)};DDLS.ObjectMap=function(){this.h={};this.h.__keys__={}};
DDLS.ObjectMap.prototype={set:function(a,b){var c=a.__id__||(a.__id__=++DDLS.ObjectMap.count);this.h[c]=b;this.h.__keys__[c]=a},get:function(a){return this.h[a.__id__]}};DDLS.ObjectMap.count=0;DDLS.Fid=0;DDLS.Bind=function(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=DDLS.Fid++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=function(){return c.method.apply(c.scope,arguments)},c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c);return c};
DDLS.StringTools=function(){};DDLS.StringTools.hex=function(a,b){var c="";do c="0123456789ABCDEF".charAt(a&15)+c,a>>>=4;while(0<a);if(null!=b)for(;c.length<b;)c="0"+c;return c};DDLS.Bytes=function(a,b){this.length=a;this.b=b};DDLS.Bytes.alloc=function(a){for(var b=[],c=0;c<a;)c++,b.push(0);return new DDLS.Bytes(a,b)};DDLS.Timer=function(){};DDLS.Timer.__name__=!0;DDLS.Timer.stamp=function(){return(new Date).getTime()/1E3};DDLS.Intersection={__ename__:!0,__constructs__:["EVertex","EEdge","EFace","ENull"]};
DDLS.Intersection.EVertex=function(a){a=["EVertex",0,a];a.__enum__=DDLS.Intersection;return a};DDLS.Intersection.EEdge=function(a){a=["EEdge",1,a];a.__enum__=DDLS.Intersection;return a};DDLS.Intersection.EFace=function(a){a=["EFace",2,a];a.__enum__=DDLS.Intersection;return a};DDLS.Intersection.ENull=["ENull",3];DDLS.Intersection.ENull.__enum__=DDLS.Intersection;DDLS.Point=function(a,b){this.x=a||0;this.y=b||0};
DDLS.Point.prototype={constructor:DDLS.Point,transform:function(a){a.tranform(this)},setXY:function(a,b){this.x=a;this.y=b},clone:function(){return new DDLS.Point(this.x,this.y)},substract:function(a){this.x-=a.x;this.y-=a.y},get_length:function(){return DDLS.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=this.get_length();this.x/=a;this.y/=a},scale:function(a){this.x*=a;this.y*=a},distanceTo:function(a){var b=this.x-a.x;a=this.y-a.y;return DDLS.sqrt(b*b+a*a)}};DDLS.Matrix=function(a,b,c,d,e,f){this.a=a||0;this.b=b||0;this.c=c||0;this.d=d||0;this.e=e||0;this.f=f||0};
DDLS.Matrix.prototype={constructor:DDLS.Matrix,identity:function(){this.a=1;this.c=this.b=0;this.d=1;this.f=this.e=0},translate:function(a,b){this.e+=a;this.f+=b},scale:function(a,b){this.a*=a;this.b*=b;this.c*=a;this.d*=b;this.e*=a;this.f*=b},rotate:function(a){var b=DDLS.cos(a);a=DDLS.sin(a);var c=this.a*a+this.b*b,d=this.c*b+this.d*-a,e=this.c*a+this.d*b,f=this.e*b+this.f*-a,h=this.e*a+this.f*b;this.a=this.a*b+this.b*-a;this.b=c;this.c=d;this.d=e;this.e=f;this.f=h},clone:function(){return new DDLS.Matrix(this.a,
this.b,this.c,this.d,this.e,this.f)},tranform:function(a){var b=this.b*a.x+this.d*a.y+this.f;a.x=this.a*a.x+this.c*a.y+this.e;a.y=b},transformX:function(a,b){return this.a*a+this.c*b+this.e},transformY:function(a,b){return this.b*a+this.d*b+this.f},concat:function(a){var b=this.a*a.b+this.b*a.d,c=this.c*a.a+this.d*a.c,d=this.c*a.b+this.d*a.d,e=this.e*a.a+this.f*a.c+a.e,f=this.e*a.b+this.f*a.d+a.f;this.a=this.a*a.a+this.b*a.c;this.b=b;this.c=c;this.d=d;this.e=e;this.f=f}};DDLS.RandGenerator=function(a,b,c){this.rangeMin=b||0;this.rangeMax=c||1;this._originalSeed=this._currSeed=a||1234;this._numIter=0};
DDLS.RandGenerator.prototype={constructor:DDLS.RandGenerator,set_seed:function(a){return this._originalSeed=this._currSeed=a},get_seed:function(){return this._originalSeed},reset:function(){this._currSeed=this._originalSeed;this._numIter=0},next:function(){var a=1*this._currSeed;for(this._tempString=(a*a).toString();8>this._tempString.length;)this._tempString="0"+this._tempString;this._currSeed=parseInt(this._tempString.substr(1,5));a=DDLS.round(this.rangeMin+this._currSeed/99999*(this.rangeMax-this.rangeMin));
0==this._currSeed&&(this._currSeed=this._originalSeed+this._numIter);this._numIter++;200==this._numIter&&this.reset();return a},nextInRange:function(a,b){this.rangeMin=a;this.rangeMax=b;return this.next()},shuffle:function(a){for(var b=a.length;0<b;){var c=this.nextInRange(0,b-1);b--;var d=a[b];a[b]=a[c];a[c]=d}}};DDLS.Edge=function(){this.colorDebug=-1;this._id=DDLS.EdgeID;DDLS.EdgeID++;this.fromConstraintSegments=[]};
DDLS.Edge.prototype={constructor:DDLS.Edge,get_id:function(){return this._id},get_isReal:function(){return this._isReal},get_isConstrained:function(){return this._isConstrained},setDatas:function(a,b,c,d,e,f){null==f&&(f=!1);null==e&&(e=!0);this._isConstrained=f;this._isReal=e;this._originVertex=a;this._oppositeEdge=b;this._nextLeftEdge=c;this._leftFace=d},addFromConstraintSegment:function(a){-1==DDLS.Overrides.indexOf(this.fromConstraintSegments,a,0)&&this.fromConstraintSegments.push(a)},removeFromConstraintSegment:function(a){a=
DDLS.Overrides.indexOf(this.fromConstraintSegments,a,0);-1!=a&&this.fromConstraintSegments.splice(a,1)},set_originVertex:function(a){this._originVertex=a},set_nextLeftEdge:function(a){this._nextLeftEdge=a},set_leftFace:function(a){this._leftFace=a},set_isConstrained:function(a){this._isConstrained=a},dispose:function(){this.fromConstraintSegments=this._leftFace=this._nextLeftEdge=this._oppositeEdge=this._originVertex=null},get_originVertex:function(){return this._originVertex},get_destinationVertex:function(){return this.get_oppositeEdge().get_originVertex()},
get_oppositeEdge:function(){return this._oppositeEdge},get_nextLeftEdge:function(){return this._nextLeftEdge},get_prevLeftEdge:function(){return this._nextLeftEdge.get_nextLeftEdge()},get_nextRightEdge:function(){return this._oppositeEdge.get_nextLeftEdge().get_nextLeftEdge().get_oppositeEdge()},get_prevRightEdge:function(){return this._oppositeEdge.get_nextLeftEdge().get_oppositeEdge()},get_rotLeftEdge:function(){return this._nextLeftEdge.get_nextLeftEdge().get_oppositeEdge()},get_rotRightEdge:function(){return this._oppositeEdge.get_nextLeftEdge()},
get_leftFace:function(){return this._leftFace},get_rightFace:function(){return this._oppositeEdge.get_leftFace()},toString:function(){return"edge "+this.get_originVertex().get_id()+" - "+this.get_destinationVertex().get_id()}};DDLS.Face=function(){this.colorDebug=-1;this._id=DDLS.FaceID;DDLS.FaceID++};DDLS.Face.prototype={constructor:DDLS.Face,get_id:function(){return this._id},get_isReal:function(){return this._isReal},setDatas:function(a,b){null==b&&(b=!0);this._isReal=b;this._edge=a},dispose:function(){this._edge=null},get_edge:function(){return this._edge}};DDLS.Vertex=function(){this.colorDebug=-1;this._id=DDLS.VertexID;DDLS.VertexID++;this._pos=new DDLS.Point;this._fromConstraintSegments=[]};
DDLS.Vertex.prototype={constructor:DDLS.Vertex,get_id:function(){return this._id},get_isReal:function(){return this._isReal},get_pos:function(){return this._pos},get_fromConstraintSegments:function(){return this._fromConstraintSegments},set_fromConstraintSegments:function(a){return this._fromConstraintSegments=a},setDatas:function(a,b){null==b&&(b=!0);this._isReal=b;this._edge=a},addFromConstraintSegment:function(a){-1==DDLS.Overrides.indexOf(this._fromConstraintSegments,a,0)&&this._fromConstraintSegments.push(a)},
removeFromConstraintSegment:function(a){a=DDLS.Overrides.indexOf(this._fromConstraintSegments,a,0);-1!=a&&this._fromConstraintSegments.splice(a,1)},dispose:function(){this._fromConstraintSegments=this._edge=this._pos=null},get_edge:function(){return this._edge},set_edge:function(a){return this._edge=a},toString:function(){return"ver_id "+this._id}};DDLS.Object=function(){this._id=DDLS.ObjectID;DDLS.ObjectID++;this._pivotY=this._pivotX=0;this._matrix=new DDLS.Matrix;this._scaleY=this._scaleX=1;this._y=this._x=this._rotation=0;this._coordinates=[];this._hasChanged=!1};
DDLS.Object.prototype={constructor:DDLS.Object,get_id:function(){return this._id},dispose:function(){this._constraintShape=this._coordinates=this._matrix=null},updateValuesFromMatrix:function(){},updateMatrixFromValues:function(){this._matrix.identity();this._matrix.translate(-this._pivotX,-this._pivotY);this._matrix.scale(this._scaleX,this._scaleY);this._matrix.rotate(this._rotation);this._matrix.translate(this._x,this._y)},get_pivotX:function(){return this._pivotX},set_pivotX:function(a){this._pivotX=
a;this._hasChanged=!0},get_pivotY:function(){return this._pivotY},set_pivotY:function(a){this._pivotY=a;this._hasChanged=!0},get_scaleX:function(){return this._scaleX},set_scaleX:function(a){this._scaleX!=a&&(this._scaleX=a,this._hasChanged=!0)},get_scaleY:function(){return this._scaleY},set_scaleY:function(a){this._scaleY!=a&&(this._scaleY=a,this._hasChanged=!0)},get_rotation:function(){return this._rotation},set_rotation:function(a){this._rotation!=a&&(this._rotation=a,this._hasChanged=!0)},get_x:function(){return this._x},
set_x:function(a){this._x!=a&&(this._x=a,this._hasChanged=!0)},get_y:function(){return this._y},set_y:function(a){this._y!=a&&(this._y=a,this._hasChanged=!0)},get_matrix:function(){return this._matrix},set_matrix:function(a){this._matrix=a;this._hasChanged=!0},get_coordinates:function(){return this._coordinates},set_coordinates:function(a){this._coordinates=a;this._hasChanged=!0},get_constraintShape:function(){return this._constraintShape},set_constraintShape:function(a){this._constraintShape=a;this._hasChanged=
!0},get_hasChanged:function(){return this._hasChanged},set_hasChanged:function(a){this._hasChanged=a},get_edges:function(){for(var a=[],b=this._constraintShape.segments,c=0,d=b.length;c<d;)for(var e=c++,f=0,h=b[e].get_edges().length;f<h;){var g=f++;a.push(b[e].get_edges()[g])}return a}};DDLS.Segment=function(a,b){this._id=DDLS.SegmentID;DDLS.SegmentID++;this._edges=[]};
DDLS.Segment.prototype={constructor:DDLS.Segment,get_id:function(){return this._id},addEdge:function(a){var b;if(b=-1==DDLS.Overrides.indexOf(this._edges,a,0))b=a.get_oppositeEdge(),b=-1==DDLS.Overrides.indexOf(this._edges,b,0);b&&this._edges.push(a)},removeEdge:function(a){var b;b=DDLS.Overrides.indexOf(this._edges,a,0);-1==b&&(a=a.get_oppositeEdge(),b=DDLS.Overrides.indexOf(this._edges,a,0));-1!=b&&this._edges.splice(b,1)},get_edges:function(){return this._edges},dispose:function(){this.fromShape=
this._edges=null},toString:function(){return"seg_id "+this._id}};DDLS.Shape=function(a,b){this._id=DDLS.ShapeID;DDLS.ShapeID++;this.segments=[]};DDLS.Shape.prototype={constructor:DDLS.Shape,get_id:function(){return this._id},dispose:function(){for(;0<this.segments.length;)this.segments.pop().dispose();this.segments=null}};DDLS.FromEdgeToRotatedEdges=function(){};DDLS.FromFaceToInnerVertices=function(){};DDLS.FromFaceToInnerVertices.prototype={set_fromFace:function(a){this._fromFace=a;this._nextEdge=this._fromFace.get_edge()},next:function(){null!=this._nextEdge?(this._resultVertex=this._nextEdge.get_originVertex(),this._nextEdge=this._nextEdge.get_nextLeftEdge(),this._nextEdge==this._fromFace.get_edge()&&(this._nextEdge=null)):this._resultVertex=null;return this._resultVertex}};DDLS.FromFaceToInnerEdges=function(){};
DDLS.FromFaceToInnerEdges.prototype={set_fromFace:function(a){this._fromFace=a;this._nextEdge=this._fromFace.get_edge()},next:function(){null!=this._nextEdge?(this._resultEdge=this._nextEdge,this._nextEdge=this._nextEdge.get_nextLeftEdge(),this._nextEdge==this._fromFace.get_edge()&&(this._nextEdge=null)):this._resultEdge=null;return this._resultEdge}};DDLS.FromFaceToNeighbourFaces=function(){};
DDLS.FromFaceToNeighbourFaces.prototype={set_fromFace:function(a){this._fromFace=a;this._nextEdge=this._fromFace.get_edge()},next:function(){if(null!=this._nextEdge){do if(this._resultFace=this._nextEdge.get_rightFace(),this._nextEdge=this._nextEdge.get_nextLeftEdge(),this._nextEdge==this._fromFace.get_edge()){this._nextEdge=null;this._resultFace.isReal||(this._resultFace=null);break}while(!this._resultFace.get_isReal())}else this._resultFace=null;return this._resultFace}};
DDLS.FromMeshToVertices=function(){};DDLS.FromMeshToVertices.prototype={set_fromMesh:function(a){this._fromMesh=a;this._currIndex=0},next:function(){do if(this._currIndex<this._fromMesh._vertices.length)this._resultVertex=this._fromMesh._vertices[this._currIndex],this._currIndex++;else{this._resultVertex=null;break}while(!this._resultVertex.get_isReal());return this._resultVertex}};DDLS.FromMeshToFaces=function(){};
DDLS.FromMeshToFaces.prototype={set_fromMesh:function(a){this._fromMesh=a;this._currIndex=0},next:function(){do if(this._currIndex<this._fromMesh._faces.length)this._resultFace=this._fromMesh._faces[this._currIndex],this._currIndex++;else{this._resultFace=null;break}while(!this._resultFace.get_isReal());return this._resultFace}};DDLS.FromVertexToHoldingFaces=function(){};
DDLS.FromVertexToHoldingFaces.prototype={set_fromVertex:function(a){this._fromVertex=a;this._nextEdge=this._fromVertex.get_edge()},next:function(){if(null!=this._nextEdge){do if(this._resultFace=this._nextEdge.get_leftFace(),this._nextEdge=this._nextEdge.get_rotLeftEdge(),this._nextEdge==this._fromVertex.get_edge()){this._nextEdge=null;this._resultFace.get_isReal()||(this._resultFace=null);break}while(!this._resultFace.get_isReal())}else this._resultFace=null;return this._resultFace}};
DDLS.FromVertexToIncomingEdges=function(){};
DDLS.FromVertexToIncomingEdges.prototype={set_fromVertex:function(a){this._fromVertex=a;for(this._nextEdge=this._fromVertex.get_edge();!this._nextEdge.get_isReal();)this._nextEdge=this._nextEdge.get_rotLeftEdge()},next:function(){if(null!=this._nextEdge){this._resultEdge=this._nextEdge.get_oppositeEdge();do if(this._nextEdge=this._nextEdge.get_rotLeftEdge(),this._nextEdge==this._fromVertex.get_edge()){this._nextEdge=null;break}while(!this._nextEdge.get_isReal())}else this._resultEdge=null;return this._resultEdge}};
DDLS.FromVertexToOutgoingEdges=function(){this.realEdgesOnly=!0};
DDLS.FromVertexToOutgoingEdges.prototype={set_fromVertex:function(a){this._fromVertex=a;for(this._nextEdge=this._fromVertex.get_edge();this.realEdgesOnly&&!this._nextEdge.get_isReal();)this._nextEdge=this._nextEdge.get_rotLeftEdge()},next:function(){if(null!=this._nextEdge){this._resultEdge=this._nextEdge;do if(this._nextEdge=this._nextEdge.get_rotLeftEdge(),this._nextEdge==this._fromVertex.get_edge()){this._nextEdge=null;break}while(this.realEdgesOnly&&!this._nextEdge.get_isReal())}else this._resultEdge=
null;return this._resultEdge}};DDLS.FromVertexToNeighbourVertices=function(){};DDLS.FromVertexToNeighbourVertices.prototype={set_fromVertex:function(a){this._fromVertex=a;this._nextEdge=this._fromVertex.get_edge()},next:function(){if(null!=this._nextEdge){this._resultVertex=this._nextEdge.get_destinationVertex();do this._nextEdge=this._nextEdge.get_rotLeftEdge();while(!this._nextEdge.get_isReal());this._nextEdge==this._fromVertex.get_edge()&&(this._nextEdge=null)}else this._resultVertex=null;return this._resultVertex}};DDLS.Geom2D={};DDLS.Geom2D.__samples=[];DDLS.Geom2D.__circumcenter=new DDLS.Point;
DDLS.Geom2D.locatePosition=function(a,b,c){null==DDLS.Geom2D._randGen&&(DDLS.Geom2D._randGen=new DDLS.RandGenerator);DDLS.Geom2D._randGen.set_seed(10*a+4*b|0);DDLS.Geom2D.__samples.splice(0,DDLS.Geom2D.__samples.length);var d=DDLS.Std.int(DDLS.pow(c._vertices.length,0.3333333333333333));DDLS.Geom2D._randGen.rangeMin=0;DDLS.Geom2D._randGen.rangeMax=c._vertices.length-1;for(var e=0,f;e<d;)e++,f=DDLS.Geom2D._randGen.next(),DDLS.Debug.assertFalse(0>f||f>c._vertices.length-1,"_rnd: "+f,{fileName:"Geom2D.hx",
lineNumber:67,className:"DDLS.Geom2D",methodName:"locatePosition"}),DDLS.Debug.assertFalse(null==c._vertices,"vertices: "+c._vertices.length,{fileName:"Geom2D.hx",lineNumber:68,className:"DDLS.Geom2D",methodName:"locatePosition"}),DDLS.Geom2D.__samples.push(c._vertices[f]);var h,g,e=DDLS.POSITIVE_INFINITY;c=null;for(f=0;f<d;)h=f++,h=DDLS.Geom2D.__samples[h],g=h.get_pos(),g=(g.x-a)*(g.x-a)+(g.y-b)*(g.y-b),g<e&&(e=g,c=h);d=new DDLS.FromVertexToHoldingFaces;d.set_fromVertex(c);h=d.next();d=new DDLS.ObjectMap;
c=new DDLS.FromFaceToInnerEdges;e=DDLS.Intersection.ENull;for(f=0;d.h[h.__id__]||3==(e=DDLS.Geom2D.isInFace(a,b,h))[1];){f++;50==f&&DDLS.Log("WALK TAKE MORE THAN 50 LOOP",{fileName:"Geom2D.hx",lineNumber:107,className:"DDLS.Geom2D",methodName:"locatePosition"});c.set_fromFace(h);do{h=c.next();if(null==h)return DDLS.Log("KILL PATH",{fileName:"Geom2D.hx",lineNumber:115,className:"DDLS.Geom2D",methodName:"locatePosition"}),DDLS.Intersection.ENull;g=DDLS.Geom2D.getRelativePosition(a,b,h)}while(1==g||
0==g);h=h.get_rightFace()}return e};
DDLS.Geom2D.isCircleIntersectingAnyConstraint=function(a,b,c,d){if(0>=a||a>=d.get_width()||0>=b||b>=d.get_height())return!0;d=DDLS.Geom2D.locatePosition(a,b,d);var e;switch(d[1]){case 0:e=d[2].get_edge().get_leftFace();break;case 1:e=d[2].get_leftFace();break;case 2:e=d[2];break;case 3:e=null}d=c*c;var f;f=e.get_edge().get_originVertex().get_pos();f=(f.x-a)*(f.x-a)+(f.y-b)*(f.y-b);if(f<=d)return!0;f=e.get_edge().get_nextLeftEdge().get_originVertex().get_pos();f=(f.x-a)*(f.x-a)+(f.y-b)*(f.y-b);if(f<=
d)return!0;f=e.get_edge().get_nextLeftEdge().get_nextLeftEdge().get_originVertex().get_pos();f=(f.x-a)*(f.x-a)+(f.y-b)*(f.y-b);if(f<=d)return!0;var h=[];h.push(e.get_edge());h.push(e.get_edge().get_nextLeftEdge());h.push(e.get_edge().get_nextLeftEdge().get_nextLeftEdge());for(var g,k=new DDLS.ObjectMap;0<h.length;)if(g=h.pop(),k.set(g,!0),e=g.get_originVertex().get_pos(),d=g.get_destinationVertex().get_pos(),e=DDLS.Geom2D.intersectionsSegmentCircle(e.x,e.y,d.x,d.y,a,b,c)){if(g.get_isConstrained())return!0;
g=g.get_oppositeEdge().get_nextLeftEdge();k.h[g.__id__]||function(a){a=g.get_oppositeEdge();return k.h[a.__id__]}(this)||-1!=DDLS.Overrides.indexOf(h,g,0)||-1!=function(a){a=g.get_oppositeEdge();return DDLS.Overrides.indexOf(h,a,0)}(this)||h.push(g);g=g.get_nextLeftEdge();k.h[g.__id__]||function(a){a=g.get_oppositeEdge();return k.h[a.__id__]}(this)||-1!=DDLS.Overrides.indexOf(h,g,0)||-1!=function(a){a=g.get_oppositeEdge();return DDLS.Overrides.indexOf(h,a,0)}(this)||h.push(g)}return!1};
DDLS.Geom2D.getDirection=function(a,b,c,d,e,f){a=(e-a)*(d-b)+(f-b)*(-c+a);return 0==a?0:0<a?1:-1};DDLS.Geom2D.getDirection2=function(a,b,c,d,e,f){var h=(e-a)*(d-b)+(f-b)*(-c+a);return 0==h?0:0<h?1E-4>=DDLS.Geom2D.distanceSquaredPointToLine(e,f,a,b,c,d)?0:1:1E-4>=DDLS.Geom2D.distanceSquaredPointToLine(e,f,a,b,c,d)?0:-1};
DDLS.Geom2D.getRelativePosition=function(a,b,c){return DDLS.Geom2D.getDirection(c.get_originVertex().get_pos().x,c.get_originVertex().get_pos().y,c.get_destinationVertex().get_pos().x,c.get_destinationVertex().get_pos().y,a,b)};DDLS.Geom2D.getRelativePosition2=function(a,b,c){return DDLS.Geom2D.getDirection2(c.get_originVertex().get_pos().x,c.get_originVertex().get_pos().y,c.get_destinationVertex().get_pos().x,c.get_destinationVertex().get_pos().y,a,b)};
DDLS.Geom2D.isInFace=function(a,b,c){var d=DDLS.Intersection.ENull,e=c.get_edge(),f=e.get_nextLeftEdge(),h=f.get_nextLeftEdge();if(0<=DDLS.Geom2D.getRelativePosition(a,b,e)&&0<=DDLS.Geom2D.getRelativePosition(a,b,f)&&0<=DDLS.Geom2D.getRelativePosition(a,b,h))var d=e.get_originVertex(),g=f.get_originVertex(),k=h.get_originVertex(),n=d.get_pos().x,m=d.get_pos().y,l=g.get_pos().x,p=g.get_pos().y,r=k.get_pos().x,q=k.get_pos().y,s=(a-n)*(l-n)+(b-m)*(p-m),t=(a-l)*(r-l)+(b-p)*(q-p),v=(a-r)*(n-r)+(b-q)*(m-
q),t=1E-4>=(l-a)*(l-a)+(p-b)*(p-b)-t*t/((r-l)*(r-l)+(q-p)*(q-p)),r=1E-4>=(r-a)*(r-a)+(q-b)*(q-b)-v*v/((n-r)*(n-r)+(m-q)*(m-q)),d=1E-4>=(n-a)*(n-a)+(m-b)*(m-b)-s*s/((l-n)*(l-n)+(p-m)*(p-m))?r?DDLS.Intersection.EVertex(d):t?DDLS.Intersection.EVertex(g):DDLS.Intersection.EEdge(e):t?r?DDLS.Intersection.EVertex(k):DDLS.Intersection.EEdge(f):r?DDLS.Intersection.EEdge(h):DDLS.Intersection.EFace(c);return d};
DDLS.Geom2D.clipSegmentByTriangle=function(a,b,c,d,e,f,h,g,k,n,m,l){var p,r;p=DDLS.Geom2D.getDirection(e,f,h,g,a,b);r=DDLS.Geom2D.getDirection(e,f,h,g,c,d);if(0>=p&&0>=r)return!1;var q,s;q=DDLS.Geom2D.getDirection(h,g,k,n,a,b);s=DDLS.Geom2D.getDirection(h,g,k,n,c,d);if(0>=q&&0>=s)return!1;var t,v;t=DDLS.Geom2D.getDirection(k,n,e,f,a,b);v=DDLS.Geom2D.getDirection(k,n,e,f,c,d);if(0>=t&&0>=v)return!1;if(0<=p&&0<=q&&0<=t&&0<=r&&0<=s&&0<=v)return m.x=a,m.y=b,l.x=c,l.y=d,!0;var u=0;DDLS.Geom2D.intersections2segments(a,
b,c,d,e,f,h,g,m,null)&&u++;0==u?DDLS.Geom2D.intersections2segments(a,b,c,d,h,g,k,n,m,null)&&u++:DDLS.Geom2D.intersections2segments(a,b,c,d,h,g,k,n,l,null)&&(-0.01>m.x-l.x||0.01<m.x-l.x||-0.01>m.y-l.y||0.01<m.y-l.y)&&u++;0==u?DDLS.Geom2D.intersections2segments(a,b,c,d,k,n,e,f,m,null)&&u++:1==u&&DDLS.Geom2D.intersections2segments(a,b,c,d,k,n,e,f,l,null)&&(-0.01>m.x-l.x||0.01<m.x-l.x||-0.01>m.y-l.y||0.01<m.y-l.y)&&u++;1==u&&(0<=p&&0<=q&&0<=t?(l.x=a,l.y=b):0<=r&&0<=s&&0<=v?(l.x=c,l.y=d):u=0);return 0<
u?!0:!1};
DDLS.Geom2D.isSegmentIntersectingTriangle=function(a,b,c,d,e,f,h,g,k,n){var m,l;m=DDLS.Geom2D.getDirection(e,f,h,g,a,b);l=DDLS.Geom2D.getDirection(e,f,h,g,c,d);if(0>=m&&0>=l)return!1;var p,r;p=DDLS.Geom2D.getDirection(h,g,k,n,a,b);r=DDLS.Geom2D.getDirection(h,g,k,n,c,d);if(0>=p&&0>=r)return!1;var q,s;q=DDLS.Geom2D.getDirection(k,n,e,f,a,b);s=DDLS.Geom2D.getDirection(k,n,e,f,c,d);if(0>=q&&0>=s)return!1;if(1==m&&1==p&&1==q||1==m&&1==p&&1==q)return!0;if(1==m&&0>=l||0>=m&&1==l)if(m=DDLS.Geom2D.getDirection(a,b,
c,d,e,f),l=DDLS.Geom2D.getDirection(a,b,c,d,h,g),1==m&&0>=l||0>=m&&1==l)return!0;if(1==p&&0>=r||0>=p&&1==r)if(m=DDLS.Geom2D.getDirection(a,b,c,d,h,g),l=DDLS.Geom2D.getDirection(a,b,c,d,k,n),1==m&&0>=l||0>=m&&1==l)return!0;if(1==q&&0>=s||0>=q&&1==s)if(m=DDLS.Geom2D.getDirection(a,b,c,d,k,n),l=DDLS.Geom2D.getDirection(a,b,c,d,e,f),1==m&&0>=l||0>=m&&1==l)return!0;return!1};
DDLS.Geom2D.isDelaunay=function(a){var b=a.get_originVertex(),c=a.get_destinationVertex(),d=a.get_nextLeftEdge().get_destinationVertex();a=a.get_nextRightEdge().get_destinationVertex();DDLS.Geom2D.getCircumcenter(d.get_pos().x,d.get_pos().y,b.get_pos().x,b.get_pos().y,c.get_pos().x,c.get_pos().y,DDLS.Geom2D.__circumcenter);b=(d.get_pos().x-DDLS.Geom2D.__circumcenter.x)*(d.get_pos().x-DDLS.Geom2D.__circumcenter.x)+(d.get_pos().y-DDLS.Geom2D.__circumcenter.y)*(d.get_pos().y-DDLS.Geom2D.__circumcenter.y);
return(a.get_pos().x-DDLS.Geom2D.__circumcenter.x)*(a.get_pos().x-DDLS.Geom2D.__circumcenter.x)+(a.get_pos().y-DDLS.Geom2D.__circumcenter.y)*(a.get_pos().y-DDLS.Geom2D.__circumcenter.y)>=b};DDLS.Geom2D.getCircumcenter=function(a,b,c,d,e,f,h){null==h&&(h=new DDLS.Point);var g=0.5*(a+c),k=0.5*(b+d);e=(g*(a-e)+(k-0.5*(b+f))*(b-f)+0.5*(a+e)*(e-a))/(a*(f-d)+c*(b-f)+e*(d-b));h.x=g+e*(d-b);h.y=k-e*(c-a);return h};
DDLS.Geom2D.intersections2segments=function(a,b,c,d,e,f,h,g,k,n,m){null==m&&(m=!1);var l=0,p=0,r,q=(a-c)*(f-g)+(d-b)*(e-h);0==q?r=!1:(r=!0,q=1/q,m&&null==k&&null==n||(l=(a*(f-g)+b*(h-e)+e*g-f*h)*q,p=(a*(f-d)+b*(c-e)-c*f+d*e)*q,m||0<=l&&1>=l&&0<=p&&1>=p||(r=!1)));r&&(null!=k&&(k.x=a+l*(c-a),k.y=b+l*(d-b)),null!=n&&(n.push(l),n.push(p)));return r};
DDLS.Geom2D.intersections2edges=function(a,b,c,d,e){null==e&&(e=!1);return DDLS.Geom2D.intersections2segments(a.get_originVertex().get_pos().x,a.get_originVertex().get_pos().y,a.get_destinationVertex().get_pos().x,a.get_destinationVertex().get_pos().y,b.get_originVertex().get_pos().x,b.get_originVertex().get_pos().y,b.get_destinationVertex().get_pos().x,b.get_destinationVertex().get_pos().y,c,d,e)};
DDLS.Geom2D.isConvex=function(a){var b=!0,c,d;c=a.get_nextLeftEdge().get_oppositeEdge();d=a.get_nextRightEdge().get_destinationVertex();-1!=DDLS.Geom2D.getRelativePosition(d.get_pos().x,d.get_pos().y,c)?b=!1:(c=a.get_prevRightEdge(),d=a.get_prevLeftEdge().get_originVertex(),-1!=DDLS.Geom2D.getRelativePosition(d.get_pos().x,d.get_pos().y,c)&&(b=!1));return b};
DDLS.Geom2D.projectOrthogonaly=function(a,b){var c=b.get_originVertex().get_pos().x,d=b.get_originVertex().get_pos().y,e=b.get_destinationVertex().get_pos().x,f=b.get_destinationVertex().get_pos().y,h=a.x,g=a.y,h=(c*c-c*e-c*h+d*d-d*f-d*g+e*h+f*g)/(c*c-2*c*e+d*d-2*d*f+e*e+f*f);a.x=c+h*(e-c);a.y=d+h*(f-d)};DDLS.Geom2D.projectOrthogonalyOnSegment=function(a,b,c,d,e,f,h){a=(c*c-c*e-c*a+d*d-d*f-d*b+e*a+f*b)/(c*c-2*c*e+d*d-2*d*f+e*e+f*f);h.x=c+a*(e-c);h.y=d+a*(f-d)};
DDLS.Geom2D.intersections2Circles=function(a,b,c,d,e,f,h){var g=(d-a)*(d-a)+(e-b)*(e-b),k=1/(2*g);if((a!=d||b!=e)&&g<=(c+f)*(c+f)&&g>=(c-f)*(c-f)){var g=DDLS.sqrt(((c+f)*(c+f)-g)*(g-(f-c)*(f-c))),n=0.5*(a+d)+(d-a)*(c*c-f*f)*k;c=0.5*(b+e)+(e-b)*(c*c-f*f)*k;b=(e-b)*k;d=(d-a)*k;if(null!=h)for(a=0,g=[n+b*g,c-d*g,n-b*g,c+d*g];a<g.length;)n=g[a],++a,h.push(n);return!0}return!1};
DDLS.Geom2D.intersectionsSegmentCircle=function(a,b,c,d,e,f,h,g){var k=a*a,n=b*b,m=d*d-2*d*b+n+c*c-2*c*a+k,l=2*b*f-2*k+2*d*b-2*n+2*c*a-2*c*e+2*a*e-2*d*f;e=l*l-4*m*(n+f*f+e*e-2*b*f-2*a*e+k-h*h);if(0>e)return!1;if(0==e){e=-l/(2*m);if(0>e||1<e)return!1;if(null!=g)for(m=0,a=[a+e*(c-a),b+e*(d-b),e];m<a.length;)b=a[m],++m,g.push(b);return!0}f=DDLS.sqrt(e);e=(-l+f)/(2*m);m=(-l-f)/(2*m);l=!1;if(0<=e&&1>=e){if(null!=g)for(l=0,e=[a+e*(c-a),b+e*(d-b),e];l<e.length;)f=e[l],++l,g.push(f);l=!0}if(0<=m&&1>=m){if(null!=
g)for(l=0,a=[a+m*(c-a),b+m*(d-b),m];l<a.length;)b=a[l],++l,g.push(b);l=!0}return l};
DDLS.Geom2D.intersectionsLineCircle=function(a,b,c,d,e,f,h,g){var k=a*a,n=b*b,m=d*d-2*d*b+n+c*c-2*c*a+k,l=2*b*f-2*k+2*d*b-2*n+2*c*a-2*c*e+2*a*e-2*d*f;e=l*l-4*m*(n+f*f+e*e-2*b*f-2*a*e+k-h*h);if(0>e)return!1;if(0==e)for(e=-l/(2*m),m=0,a=[a+e*(c-a),b+e*(d-b),e];m<a.length;)b=a[m],++m,g.push(b);else if(0<e)for(f=DDLS.sqrt(e),e=(-l+f)/(2*m),l=(-l-f)/(2*m),m=0,a=[a+e*(c-a),b+e*(d-b),e,a+l*(c-a),b+l*(d-b),l];m<a.length;)b=a[m],++m,g.push(b);return!0};
DDLS.Geom2D.tangentsPointToCircle=function(a,b,c,d,e,f){var h=0.5*(a+c),g=0.5*(b+d);a=0.5*DDLS.sqrt((a-c)*(a-c)+(b-d)*(b-d));return DDLS.Geom2D.intersections2Circles(h,g,a,c,d,e,f)};
DDLS.Geom2D.tangentsCrossCircleToCircle=function(a,b,c,d,e,f){var h=DDLS.sqrt((b-d)*(b-d)+(c-e)*(c-e));if(DDLS.Geom2D.intersections2Circles(b,c,a,b+0.25*(d-b),c+0.25*(e-c),0.25*h,f)){a=f[0];var g=f[1],k=0.5*(b+d),n=0.5*(c+e),h=((a-k)*(e-c)+(g-n)*(-d+b))/(h*h);c=2*(k+h*(e-c))-a;d=2*(n-h*(d-b))-g;b=0;for(a=[c+f[2]-a,f[3]+d-g,c,d];b<a.length;)g=a[b],++b,f.push(g);return!0}return!1};
DDLS.Geom2D.tangentsParalCircleToCircle=function(a,b,c,d,e,f){var h=1/DDLS.sqrt((b-d)*(b-d)+(c-e)*(c-e)),g=b+a*(e-c)*h,h=c+a*(-d+b)*h,k=2*b-g,n=2*c-h;a=0;for(b=[g,h,k,n,k+d-b,n+e-c,g+d-b,h+e-c];a<b.length;)c=b[a],++a,f.push(c)};DDLS.Geom2D.distanceSquaredPointToLine=function(a,b,c,d,e,f){var h=(a-c)*(e-c)+(b-d)*(f-d);return(c-a)*(c-a)+(d-b)*(d-b)-h*h/((e-c)*(e-c)+(f-d)*(f-d))};
DDLS.Geom2D.distanceSquaredPointToSegment=function(a,b,c,d,e,f){var h=(e-c)*(e-c)+(f-d)*(f-d),g=((a-c)*(e-c)+(b-d)*(f-d))/h;return 0>g?(a-c)*(a-c)+(b-d)*(b-d):1>=g?(c-a)*(c-a)+(d-b)*(d-b)-g*g*h:(a-e)*(a-e)+(b-f)*(b-f)};DDLS.Geom2D.distanceSquaredVertexToEdge=function(a,b){return DDLS.Geom2D.distanceSquaredPointToSegment(a.get_pos().x,a.get_pos().y,b.get_originVertex().get_pos().x,b.get_originVertex().get_pos().y,b.get_destinationVertex().get_pos().x,b.get_destinationVertex().get_pos().y)};
DDLS.Geom2D.pathLength=function(a){for(var b=0,c=a[0],d=a[1],e,f,h=2;h<a.length;)e=a[h],f=a[h+1],c=e-c,d=f-d,d=DDLS.sqrt(c*c+d*d),b+=d,c=e,d=f,h+=2;return b};DDLS.Mesh=function(a,b){this._id=DDLS.MeshID;DDLS.MeshID++;this.__objectsUpdateInProgress=!1;this.__centerVertex=null;this._width=a;this._height=b;this._clipping=!0;this._edges=[];this._faces=[];this._objects=[];this._vertices=[];this.__edgesToCheck=[];this._constraintShapes=[]};
DDLS.Mesh.prototype={constructor:DDLS.Mesh,get_height:function(){return this._height},get_width:function(){return this._width},get_clipping:function(){return this._clipping},set_clipping:function(a){return this._clipping=a},get_id:function(){return this._id},dispose:function(){for(;0<this._vertices.length;)this._vertices.pop().dispose();for(this._vertices=null;0<this._edges.length;)this._edges.pop().dispose();for(this._edges=null;0<this._faces.length;)this._faces.pop().dispose();for(this._faces=null;0<
this._constraintShapes.length;)this._constraintShapes.pop().dispose();for(this._constraintShapes=null;0<this._objects.length;)this._objects.pop().dispose();this.__centerVertex=this.__edgesToCheck=this._objects=null},get___constraintShapes:function(){return this._constraintShapes},buildFromRecord:function(a){a=a.split(";");for(var b=0;b<a.length;)this.insertConstraintSegment(DDLS.Std.parseFloat(a[b]),DDLS.Std.parseFloat(a[b+1]),DDLS.Std.parseFloat(a[b+2]),DDLS.Std.parseFloat(a[b+3])),b+=4},insertObject:function(a){null!=
a.get_constraintShape()&&this.deleteObject(a);var b=new DDLS.Shape,c,d=a.get_coordinates(),e=a.get_matrix();a.updateMatrixFromValues();for(var f,h,g,k,n=0;n<d.length;)f=d[n],h=d[n+1],g=d[n+2],k=d[n+3],c=e.transformX(f,h),f=e.transformY(f,h),h=e.transformX(g,k),g=e.transformY(g,k),c=this.insertConstraintSegment(c,f,h,g),null!=c&&(c.fromShape=b,b.segments.push(c)),n+=4;this._constraintShapes.push(b);a.set_constraintShape(b);this.__objectsUpdateInProgress||this._objects.push(a)},deleteObject:function(a){null!=
a.get_constraintShape()&&(this.deleteConstraintShape(a.get_constraintShape()),a.set_constraintShape(null),this.__objectsUpdateInProgress||(a=DDLS.Overrides.indexOf(this._objects,a,0),this._objects.splice(a,1)))},updateObjects:function(){this.__objectsUpdateInProgress=!0;for(var a=0,b=this._objects.length;a<b;){var c=a++;this._objects[c].get_hasChanged()&&(this.deleteObject(this._objects[c]),this.insertObject(this._objects[c]),this._objects[c].set_hasChanged(!1))}this.__objectsUpdateInProgress=!1},
insertConstraintShape:function(a){for(var b=new DDLS.Shape,c=null,d=0;d<a.length;)c=this.insertConstraintSegment(a[d],a[d+1],a[d+2],a[d+3]),null!=c&&(c.fromShape=b,b.segments.push(c)),d+=4;this._constraintShapes.push(b);return b},deleteConstraintShape:function(a){for(var b=0,c=a.segments.length;b<c;){var d=b++;this.deleteConstraintSegment(a.segments[d])}a.dispose();this._constraintShapes.splice(DDLS.Overrides.indexOf(this._constraintShapes,a,0),1)},insertConstraintSegment:function(a,b,c,d){var e=
this.findPositionFromBounds(a,b),f=this.findPositionFromBounds(c,d),h=a,g=b,k=c,n=d;if(this._clipping&&(0!=e||0!=f)){var m=new DDLS.Point;if(0!=e&&0!=f){if(0>=a&&0>=c||a>=this._width&&c>=this._width||0>=b&&0>=d||b>=this._height&&d>=this._height)return null;if(8==e&&4==f||4==e&&8==f)DDLS.Geom2D.intersections2segments(a,b,c,d,0,0,0,this._height,m),h=m.x,g=m.y,DDLS.Geom2D.intersections2segments(a,b,c,d,this._width,0,this._width,this._height,m),k=m.x,n=m.y;else if(2==e&&6==f||6==e&&2==f)DDLS.Geom2D.intersections2segments(a,
b,c,d,0,0,this._width,0,m),h=m.x,g=m.y,DDLS.Geom2D.intersections2segments(a,b,c,d,0,this._height,this._width,this._height,m),k=m.x,n=m.y;else if(2==e&&8==f||8==e&&2==f)if(DDLS.Geom2D.intersections2segments(a,b,c,d,0,0,this._width,0,m))h=m.x,g=m.y,DDLS.Geom2D.intersections2segments(a,b,c,d,0,0,0,this._height,m),k=m.x,n=m.y;else return null;else if(2==e&&4==f||4==e&&2==f)if(DDLS.Geom2D.intersections2segments(a,b,c,d,0,0,this._width,0,m))h=m.x,g=m.y,DDLS.Geom2D.intersections2segments(a,b,c,d,this._width,
0,this._width,this._height,m),k=m.x,n=m.y;else return null;else if(6==e&&4==f||4==e&&6==f)if(DDLS.Geom2D.intersections2segments(a,b,c,d,0,this._height,this._width,this._height,m))h=m.x,g=m.y,DDLS.Geom2D.intersections2segments(a,b,c,d,this._width,0,this._width,this._height,m),k=m.x,n=m.y;else return null;else if(8==e&&6==f||6==e&&8==f)if(DDLS.Geom2D.intersections2segments(a,b,c,d,0,this._height,this._width,this._height,m))h=m.x,g=m.y,DDLS.Geom2D.intersections2segments(a,b,c,d,0,0,0,this._height,m),
k=m.x,n=m.y;else return null;else if(f=e=!1,DDLS.Geom2D.intersections2segments(a,b,c,d,0,0,this._width,0,m)&&(h=m.x,g=m.y,e=!0),DDLS.Geom2D.intersections2segments(a,b,c,d,this._width,0,this._width,this._height,m)&&(e?(k=m.x,n=m.y,f=!0):(h=m.x,g=m.y,e=!0)),!f&&DDLS.Geom2D.intersections2segments(a,b,c,d,0,this._height,this._width,this._height,m)&&(e?(k=m.x,n=m.y,f=!0):(h=m.x,g=m.y,e=!0)),!f&&DDLS.Geom2D.intersections2segments(a,b,c,d,0,0,0,this._height,m)&&(k=m.x,n=m.y),!e)return null}else 2==e||2==
f?DDLS.Geom2D.intersections2segments(a,b,c,d,0,0,this._width,0,m):4==e||4==f?DDLS.Geom2D.intersections2segments(a,b,c,d,this._width,0,this._width,this._height,m):6==e||6==f?DDLS.Geom2D.intersections2segments(a,b,c,d,0,this._height,this._width,this._height,m):8==e||8==f?DDLS.Geom2D.intersections2segments(a,b,c,d,0,0,0,this._height,m):DDLS.Geom2D.intersections2segments(a,b,c,d,0,0,this._width,0,m)||DDLS.Geom2D.intersections2segments(a,b,c,d,this._width,0,this._width,this._height,m)||DDLS.Geom2D.intersections2segments(a,
b,c,d,0,this._height,this._width,this._height,m)||DDLS.Geom2D.intersections2segments(a,b,c,d,0,0,0,this._height,m),0==e?(h=a,g=b):(h=c,g=d),k=m.x,n=m.y}a=this.insertVertex(h,g);if(null==a)return null;k=this.insertVertex(k,n);if(null==k||a==k)return null;n=new DDLS.FromVertexToOutgoingEdges;b=new DDLS.Segment;c=new DDLS.Edge;d=new DDLS.Edge;c.setDatas(a,d,null,null,!0,!0);d.setDatas(k,c,null,null,!0,!0);d=[];var h=[],g=[],l,m=new DDLS.Point,p;for(l=DDLS.Intersection.EVertex(a);;)switch(p=!1,l[1]){case 0:e=
l[2];for(n.set_fromVertex(e);null!=(f=n.next());){if(f.get_destinationVertex()==k)return f.get_isConstrained()||(f.set_isConstrained(!0),f.get_oppositeEdge().set_isConstrained(!0)),f.addFromConstraintSegment(b),f.get_oppositeEdge().fromConstraintSegments=f.fromConstraintSegments,a.addFromConstraintSegment(b),k.addFromConstraintSegment(b),b.addEdge(f),b;if(1E-4>=DDLS.Geom2D.distanceSquaredVertexToEdge(f.get_destinationVertex(),c)){f.get_isConstrained()||(f.set_isConstrained(!0),f.get_oppositeEdge().set_isConstrained(!0));
f.addFromConstraintSegment(b);f.get_oppositeEdge().fromConstraintSegments=f.fromConstraintSegments;a.addFromConstraintSegment(b);b.addEdge(f);a=f.get_destinationVertex();c.set_originVertex(a);l=DDLS.Intersection.EVertex(a);p=!0;break}}if(p)continue;for(n.set_fromVertex(e);null!=(f=n.next());)if(f=f.get_nextLeftEdge(),DDLS.Geom2D.intersections2edges(f,c,m)){if(f.get_isConstrained()){a=this.splitEdge(f,m.x,m.y);for(n.set_fromVertex(e);null!=(f=n.next());)if(f.get_destinationVertex()==a){f.set_isConstrained(!0);
f.get_oppositeEdge().set_isConstrained(!0);f.addFromConstraintSegment(b);f.get_oppositeEdge().fromConstraintSegments=f.fromConstraintSegments;b.addEdge(f);break}e.addFromConstraintSegment(b);c.set_originVertex(a);l=DDLS.Intersection.EVertex(a)}else d.push(f),h.unshift(f.get_nextLeftEdge()),g.push(f.get_prevLeftEdge()),f=f.get_oppositeEdge(),l=DDLS.Intersection.EEdge(f);break}break;case 1:f=l[2];e=f.get_nextLeftEdge();if(e.get_destinationVertex()==k)return h.unshift(e.get_nextLeftEdge()),g.push(e),
f=new DDLS.Edge,l=new DDLS.Edge,f.setDatas(a,l,null,null,!0,!0),l.setDatas(k,f,null,null,!0,!0),h.push(f),g.push(l),this.insertNewConstrainedEdge(b,f,d,h,g),b;if(1E-4>=DDLS.Geom2D.distanceSquaredVertexToEdge(e.get_destinationVertex(),c))h.unshift(e.get_nextLeftEdge()),g.push(e),f=new DDLS.Edge,l=new DDLS.Edge,f.setDatas(a,l,null,null,!0,!0),l.setDatas(e.get_destinationVertex(),f,null,null,!0,!0),h.push(f),g.push(l),this.insertNewConstrainedEdge(b,f,d,h,g),d.splice(0,d.length),h.splice(0,h.length),
g.splice(0,g.length),a=e.get_destinationVertex(),c.set_originVertex(a),l=DDLS.Intersection.EVertex(a);else if(DDLS.Geom2D.intersections2edges(e,c,m))if(e.get_isConstrained()){e=this.splitEdge(e,m.x,m.y);for(n.set_fromVertex(e);null!=(f=n.next());)f.get_destinationVertex()==h[0].get_originVertex()&&h.unshift(f),f.get_destinationVertex()==g[g.length-1].get_destinationVertex()&&g.push(f.get_oppositeEdge());f=new DDLS.Edge;l=new DDLS.Edge;f.setDatas(a,l,null,null,!0,!0);l.setDatas(e,f,null,null,!0,!0);
h.push(f);g.push(l);this.insertNewConstrainedEdge(b,f,d,h,g);d.splice(0,d.length);h.splice(0,h.length);g.splice(0,g.length);a=e;c.set_originVertex(a);l=DDLS.Intersection.EVertex(a)}else d.push(e),h.unshift(e.get_nextLeftEdge()),f=e.get_oppositeEdge(),l=DDLS.Intersection.EEdge(f);else if(e=e.get_nextLeftEdge(),DDLS.Geom2D.intersections2edges(e,c,m),e.get_isConstrained()){e=this.splitEdge(e,m.x,m.y);for(n.set_fromVertex(e);null!=(f=n.next());)f.get_destinationVertex()==h[0].get_originVertex()&&h.unshift(f),
f.get_destinationVertex()==g[g.length-1].get_destinationVertex()&&g.push(f.get_oppositeEdge());f=new DDLS.Edge;l=new DDLS.Edge;f.setDatas(a,l,null,null,!0,!0);l.setDatas(e,f,null,null,!0,!0);h.push(f);g.push(l);this.insertNewConstrainedEdge(b,f,d,h,g);d.splice(0,d.length);h.splice(0,h.length);g.splice(0,g.length);a=e;c.set_originVertex(a);l=DDLS.Intersection.EVertex(a)}else d.push(e),g.push(e.get_prevLeftEdge()),f=e.get_oppositeEdge(),l=DDLS.Intersection.EEdge(f)}},insertNewConstrainedEdge:function(a,
b,c,d,e){this._edges.push(b);this._edges.push(b.get_oppositeEdge());b.addFromConstraintSegment(a);b.get_oppositeEdge().fromConstraintSegments=b.fromConstraintSegments;a.addEdge(b);b.get_originVertex().addFromConstraintSegment(a);b.get_destinationVertex().addFromConstraintSegment(a);this.untriangulate(c);this.triangulate(d,!0);this.triangulate(e,!0)},deleteConstraintSegment:function(a){for(var b=[],c=null,d,e=0,f=a.get_edges().length;e<f;)c=e++,c=a.get_edges()[c],c.removeFromConstraintSegment(a),0==
c.fromConstraintSegments.length&&(c.set_isConstrained(!1),c.get_oppositeEdge().set_isConstrained(!1)),d=c.get_originVertex(),d.removeFromConstraintSegment(a),b.push(d);d=c.get_destinationVertex();d.removeFromConstraintSegment(a);b.push(d);e=0;for(f=b.length;e<f;)c=e++,this.deleteVertex(b[c]);a.dispose()},check:function(){for(var a=0,b=this._edges.length;a<b;){var c=a++;if(null==this._edges[c].get_nextLeftEdge()){DDLS.Log("!!! missing nextLeftEdge",{fileName:"Mesh.hx",lineNumber:794,className:"DDLS.Mesh",
methodName:"check"});return}}DDLS.Log("check OK",{fileName:"Mesh.hx",lineNumber:798,className:"DDLS.Mesh",methodName:"check"})},insertVertex:function(a,b){if(0>a||0>b||a>this._width||b>this._height)return null;this.__edgesToCheck.splice(0,this.__edgesToCheck.length);var c=DDLS.Geom2D.locatePosition(a,b,this),d=null;switch(c[1]){case 0:d=c[2];break;case 1:d=this.splitEdge(c[2],a,b);break;case 2:d=this.splitFace(c[2],a,b)}this.restoreAsDelaunay();return d},flipEdge:function(a){var b=a.get_oppositeEdge(),
c=new DDLS.Edge,d=new DDLS.Edge,e=a.get_nextLeftEdge(),f=e.get_nextLeftEdge(),h=b.get_nextLeftEdge(),g=h.get_nextLeftEdge(),k=a.get_originVertex(),n=b.get_originVertex(),m=f.get_originVertex(),l=g.get_originVertex(),p=a.get_leftFace(),r=b.get_leftFace(),q=new DDLS.Face,s=new DDLS.Face;this._edges.push(c);this._edges.push(d);this._faces.push(s);this._faces.push(q);c.setDatas(m,d,g,s,a.get_isReal(),a.get_isConstrained());d.setDatas(l,c,f,q,a.get_isReal(),a.get_isConstrained());s.setDatas(c);q.setDatas(d);
n.get_edge()==b&&n.setDatas(e);k.get_edge()==a&&k.setDatas(h);e.set_nextLeftEdge(c);e.set_leftFace(s);f.set_nextLeftEdge(h);f.set_leftFace(q);h.set_nextLeftEdge(d);h.set_leftFace(q);g.set_nextLeftEdge(e);g.set_leftFace(s);a.dispose();b.dispose();this._edges.splice(DDLS.Overrides.indexOf(this._edges,a,0),1);this._edges.splice(DDLS.Overrides.indexOf(this._edges,b,0),1);p.dispose();r.dispose();this._faces.splice(DDLS.Overrides.indexOf(this._faces,p,0),1);this._faces.splice(DDLS.Overrides.indexOf(this._faces,
r,0),1);return d},splitEdge:function(a,b,c){this.__edgesToCheck.splice(0,this.__edgesToCheck.length);var d=a.get_oppositeEdge(),e=a.get_nextLeftEdge(),f=e.get_nextLeftEdge(),h=d.get_nextLeftEdge(),g=h.get_nextLeftEdge(),k=f.get_originVertex(),n=a.get_originVertex(),m=g.get_originVertex(),l=d.get_originVertex(),p=a.get_leftFace(),r=d.get_leftFace();if(1E-4>=(n.get_pos().x-b)*(n.get_pos().x-b)+(n.get_pos().y-c)*(n.get_pos().y-c))return n;if(1E-4>=(l.get_pos().x-b)*(l.get_pos().x-b)+(l.get_pos().y-c)*
(l.get_pos().y-c))return l;var q=new DDLS.Vertex,s=new DDLS.Edge,t=new DDLS.Edge,v=new DDLS.Edge,u=new DDLS.Edge,w=new DDLS.Edge,y=new DDLS.Edge,z=new DDLS.Edge,x=new DDLS.Edge,A=new DDLS.Face,B=new DDLS.Face,C=new DDLS.Face,D=new DDLS.Face;this._vertices.push(q);this._edges.push(t);this._edges.push(s);this._edges.push(y);this._edges.push(w);this._edges.push(u);this._edges.push(v);this._edges.push(x);this._edges.push(z);this._faces.push(D);this._faces.push(C);this._faces.push(B);this._faces.push(A);
q.setDatas(p.get_isReal()?t:u);q.get_pos().x=b;q.get_pos().y=c;DDLS.Geom2D.projectOrthogonaly(q.get_pos(),a);t.setDatas(q,s,f,A,p.get_isReal());s.setDatas(k,t,x,D,p.get_isReal());y.setDatas(q,w,h,B,a.get_isReal(),a.get_isConstrained());w.setDatas(n,y,t,A,a.get_isReal(),a.get_isConstrained());u.setDatas(q,v,g,C,r.get_isReal());v.setDatas(m,u,y,B,r.get_isReal());x.setDatas(q,z,e,D,a.get_isReal(),a.get_isConstrained());z.setDatas(l,x,u,C,a.get_isReal(),a.get_isConstrained());A.setDatas(t,p.get_isReal());
B.setDatas(y,r.get_isReal());C.setDatas(u,r.get_isReal());D.setDatas(x,p.get_isReal());n.get_edge()==a&&n.setDatas(w);l.get_edge()==d&&l.setDatas(z);f.set_nextLeftEdge(w);f.set_leftFace(A);h.set_nextLeftEdge(v);h.set_leftFace(B);g.set_nextLeftEdge(z);g.set_leftFace(C);e.set_nextLeftEdge(s);e.set_leftFace(D);if(a.get_isConstrained()){b=a.fromConstraintSegments;w.fromConstraintSegments=b.slice(0);y.fromConstraintSegments=w.fromConstraintSegments;x.fromConstraintSegments=b.slice(0);z.fromConstraintSegments=
x.fromConstraintSegments;c=0;for(k=a.fromConstraintSegments.length;c<k;)n=c++,n=a.fromConstraintSegments[n].get_edges(),m=DDLS.Overrides.indexOf(n,a,0),-1!=m?(n.splice(m,1),n.splice(m,0,w),n.splice(m+1,0,x)):(m=DDLS.Overrides.indexOf(n,d,0),n.splice(m,1),n.splice(m,0,z),n.splice(m,0,y));q.set_fromConstraintSegments(b.slice(0))}a.dispose();d.dispose();this._edges.splice(DDLS.Overrides.indexOf(this._edges,a,0),1);this._edges.splice(DDLS.Overrides.indexOf(this._edges,d,0),1);p.dispose();r.dispose();
this._faces.splice(DDLS.Overrides.indexOf(this._faces,p,0),1);this._faces.splice(DDLS.Overrides.indexOf(this._faces,r,0),1);this.__centerVertex=q;this.__edgesToCheck.push(f);this.__edgesToCheck.push(h);this.__edgesToCheck.push(g);this.__edgesToCheck.push(e);return q},splitFace:function(a,b,c){this.__edgesToCheck.splice(0,this.__edgesToCheck.length);var d=a.get_edge(),e=d.get_nextLeftEdge(),f=e.get_nextLeftEdge(),h=d.get_originVertex(),g=e.get_originVertex(),k=f.get_originVertex(),n=new DDLS.Vertex,
m=new DDLS.Edge,l=new DDLS.Edge,p=new DDLS.Edge,r=new DDLS.Edge,q=new DDLS.Edge,s=new DDLS.Edge,t=new DDLS.Face,v=new DDLS.Face,u=new DDLS.Face;this._vertices.push(n);this._edges.push(m);this._edges.push(l);this._edges.push(p);this._edges.push(r);this._edges.push(q);this._edges.push(s);this._faces.push(t);this._faces.push(v);this._faces.push(u);n.setDatas(l);n.get_pos().x=b;n.get_pos().y=c;m.setDatas(h,l,s,u);l.setDatas(n,m,d,t);p.setDatas(g,r,l,t);r.setDatas(n,p,e,v);q.setDatas(k,s,r,v);s.setDatas(n,
q,f,u);t.setDatas(l);v.setDatas(r);u.setDatas(s);d.set_nextLeftEdge(p);d.set_leftFace(t);e.set_nextLeftEdge(q);e.set_leftFace(v);f.set_nextLeftEdge(m);f.set_leftFace(u);a.dispose();this._faces.splice(DDLS.Overrides.indexOf(this._faces,a,0),1);this.__centerVertex=n;this.__edgesToCheck.push(d);this.__edgesToCheck.push(e);this.__edgesToCheck.push(f);return n},restoreAsDelaunay:function(){for(var a;0<this.__edgesToCheck.length;)a=this.__edgesToCheck.shift(),!a.get_isReal()||a.get_isConstrained()||DDLS.Geom2D.isDelaunay(a)||
(a.get_nextLeftEdge().get_destinationVertex()==this.__centerVertex?(this.__edgesToCheck.push(a.get_nextRightEdge()),this.__edgesToCheck.push(a.get_prevRightEdge())):(this.__edgesToCheck.push(a.get_nextLeftEdge()),this.__edgesToCheck.push(a.get_prevLeftEdge())),this.flipEdge(a))},deleteVertex:function(a){var b,c=new DDLS.FromVertexToOutgoingEdges;c.set_fromVertex(a);c.realEdgesOnly=!1;var d,e=[];b=0==a.get_fromConstraintSegments().length;var f=[],h=!1,g=!1,k=[],n=[];if(b)for(;null!=(d=c.next());)e.push(d),
f.push(d.get_nextLeftEdge());else{for(var m,k=0,n=a.get_fromConstraintSegments().length;k<n;)if(h=k++,m=a.get_fromConstraintSegments()[h].get_edges(),m[0].get_originVertex()==a||m[m.length-1].get_destinationVertex()==a)return!1;for(k=0;null!=(d=c.next());)if(e.push(d),d.get_isConstrained()&&(k++,2<k))return!1;var k=[],n=[],l=c=null,p=new DDLS.Edge,r=new DDLS.Edge;this._edges.push(p);this._edges.push(r);h=0;for(g=e.length;h<g;)m=h++,d=e[m],d.get_isConstrained()?null==c?(r.setDatas(d.get_destinationVertex(),
p,null,null,!0,!0),k.push(p),k.push(d.get_nextLeftEdge()),n.push(r),c=d):null==l&&(p.setDatas(d.get_destinationVertex(),r,null,null,!0,!0),n.push(d.get_nextLeftEdge()),l=d):null==c?n.push(d.get_nextLeftEdge()):null==l?k.push(d.get_nextLeftEdge()):n.push(d.get_nextLeftEdge());h=c.get_leftFace().get_isReal();g=l.get_leftFace().get_isReal();p.fromConstraintSegments=c.fromConstraintSegments.slice(0);r.fromConstraintSegments=p.fromConstraintSegments;for(var q,s=0,t=a.get_fromConstraintSegments().length;s<
t;)m=s++,m=a.get_fromConstraintSegments()[m].get_edges(),q=DDLS.Overrides.indexOf(m,c,0),-1!=q?(m.splice(q-1,2),m.splice(q-1,0,p)):(q=DDLS.Overrides.indexOf(m,l,0)-1,m.splice(q,2),m.splice(q,0,r))}c=0;for(l=e.length;c<l;)p=c++,d=e[p],p=d.get_leftFace(),this._faces.splice(DDLS.Overrides.indexOf(this._faces,p,0),1),p.dispose(),d.get_destinationVertex().set_edge(d.get_nextLeftEdge()),this._edges.splice(function(a){var b=d.get_oppositeEdge();return DDLS.Overrides.indexOf(a._edges,b,0)}(this),1),d.get_oppositeEdge().dispose(),
this._edges.splice(DDLS.Overrides.indexOf(this._edges,d,0),1),d.dispose();this._vertices.splice(DDLS.Overrides.indexOf(this._vertices,a,0),1);a.dispose();b?this.triangulate(f,!0):(this.triangulate(k,h),this.triangulate(n,g));return!0},untriangulate:function(a){for(var b=new DDLS.ObjectMap,c,d=0,e=a.length;d<e;){var f=d++;c=a[f];if(null==function(a){a=c.get_originVertex();return b.h[a.__id__]}(this)){c.get_originVertex().set_edge(c.get_prevLeftEdge().get_oppositeEdge());var h=c.get_originVertex();
b.set(h,!0)}null==function(a){a=c.get_destinationVertex();return b.h[a.__id__]}(this)&&(c.get_destinationVertex().set_edge(c.get_nextLeftEdge()),h=c.get_destinationVertex(),b.set(h,!0));this._faces.splice(function(a){var b=c.get_leftFace();return DDLS.Overrides.indexOf(a._faces,b,0)}(this),1);c.get_leftFace().dispose();f==a.length-1&&(this._faces.splice(function(a){var b=c.get_rightFace();return DDLS.Overrides.indexOf(a._faces,b,0)}(this),1),c.get_rightFace().dispose())}d=0;for(e=a.length;d<e;)f=
d++,c=a[f],this._edges.splice(function(a){var b=c.get_oppositeEdge();return DDLS.Overrides.indexOf(a._edges,b,0)}(this),1),this._edges.splice(DDLS.Overrides.indexOf(this._edges,c,0),1),c.get_oppositeEdge().dispose(),c.dispose()},triangulate:function(a,b){if(2>a.length)DDLS.Log("BREAK ! the hole has less than 2 edges",{fileName:"Mesh.hx",lineNumber:1396,className:"DDLS.Mesh",methodName:"triangulate"});else if(2==a.length)DDLS.Log("BREAK ! the hole has only 2 edges",{fileName:"Mesh.hx",lineNumber:1403,
className:"DDLS.Mesh",methodName:"triangulate"}),DDLS.Debug.trace("  - edge0: "+a[0].get_originVertex().get_id()+" -> "+a[0].get_destinationVertex().get_id(),{fileName:"Mesh.hx",lineNumber:1404,className:"DDLS.Mesh",methodName:"triangulate"}),DDLS.Debug.trace("  - edge1: "+a[1].get_originVertex().get_id()+" -> "+a[1].get_destinationVertex().get_id(),{fileName:"Mesh.hx",lineNumber:1405,className:"DDLS.Mesh",methodName:"triangulate"});else if(3==a.length){var c=new DDLS.Face;c.setDatas(a[0],b);this._faces.push(c);
a[0].set_leftFace(c);a[1].set_leftFace(c);a[2].set_leftFace(c);a[0].set_nextLeftEdge(a[1]);a[1].set_nextLeftEdge(a[2]);a[2].set_nextLeftEdge(a[0])}else{for(var c=a[0],d=c.get_originVertex(),e=c.get_destinationVertex(),f,h,g=new DDLS.Point,k=!1,n=0,m=2,l=a.length;m<l;){var p=m++;f=a[p].get_originVertex();if(1==DDLS.Geom2D.getRelativePosition2(f.get_pos().x,f.get_pos().y,c)){n=p;k=!0;DDLS.Geom2D.getCircumcenter(d.get_pos().x,d.get_pos().y,e.get_pos().x,e.get_pos().y,f.get_pos().x,f.get_pos().y,g);f=
(d.get_pos().x-g.x)*(d.get_pos().x-g.x)+(d.get_pos().y-g.y)*(d.get_pos().y-g.y);f-=1E-4;for(var r=2,q=a.length;r<q;)if(h=r++,h!=p&&(h=a[h].get_originVertex(),h=(h.get_pos().x-g.x)*(h.get_pos().x-g.x)+(h.get_pos().y-g.y)*(h.get_pos().y-g.y),h<f)){k=!1;break}if(k)break}}if(!k){DDLS.Log("NO DELAUNAY FOUND",{fileName:"Mesh.hx",lineNumber:1476,className:"DDLS.Mesh",methodName:"triangulate"});n="";e=0;for(g=a.length;e<g;)k=e++,n+=a[k].get_originVertex().get_pos().x+" , ",n+=a[k].get_originVertex().get_pos().y+
" , ",n+=a[k].get_destinationVertex().get_pos().x+" , ",n+=a[k].get_destinationVertex().get_pos().y+" , ";n=2}g=e=k=null;n<a.length-1&&(k=new DDLS.Edge,e=new DDLS.Edge,this._edges.push(k),this._edges.push(e),k.setDatas(d,e,null,null,b,!1),e.setDatas(a[n].get_originVertex(),k,null,null,b,!1),d=a.slice(n),d.push(k),this.triangulate(d,b));2<n&&(g=new DDLS.Edge,d=new DDLS.Edge,this._edges.push(g),this._edges.push(d),g.setDatas(a[1].get_originVertex(),d,null,null,b,!1),d.setDatas(a[n].get_originVertex(),
g,null,null,b,!1),k=a.slice(1,n),k.push(d),this.triangulate(k,b));this.triangulate(2==n?[c,a[1],e]:n==a.length-1?[c,g,a[n]]:[c,g,e],b)}},findPositionFromBounds:function(a,b){return 0>=a?0>=b?1:b>=this._height?7:8:a>=this._width?0>=b?3:b>=this._height?5:4:0>=b?2:b>=this._height?6:0},debug:function(){for(var a=0,b=this._vertices.length;a<b;){var c=a++;DDLS.Debug.trace("-- vertex "+this._vertices[c].get_id(),{fileName:"Mesh.hx",lineNumber:1568,className:"DDLS.Mesh",methodName:"debug"});DDLS.Debug.trace("  edge "+
this._vertices[c].get_edge().get_id()+" - "+DDLS.Std.string(this._vertices[c].get_edge()),{fileName:"Mesh.hx",lineNumber:1569,className:"DDLS.Mesh",methodName:"debug"});DDLS.Debug.trace("  edge isReal: "+DDLS.Std.string(this._vertices[c].get_edge().get_isReal()),{fileName:"Mesh.hx",lineNumber:1570,className:"DDLS.Mesh",methodName:"debug"})}a=0;for(b=this._edges.length;a<b;)c=a++,DDLS.Debug.trace("-- edge "+DDLS.Std.string(this._edges[c]),{fileName:"Mesh.hx",lineNumber:1573,className:"DDLS.Mesh",methodName:"debug"}),
DDLS.Debug.trace("  isReal "+this._edges[c].get_id()+" - "+DDLS.Std.string(this._edges[c].get_isReal()),{fileName:"Mesh.hx",lineNumber:1574,className:"DDLS.Mesh",methodName:"debug"}),DDLS.Debug.trace("  nextLeftEdge "+DDLS.Std.string(this._edges[c].get_nextLeftEdge()),{fileName:"Mesh.hx",lineNumber:1575,className:"DDLS.Mesh",methodName:"debug"}),DDLS.Debug.trace("  oppositeEdge "+DDLS.Std.string(this._edges[c].get_oppositeEdge()),{fileName:"Mesh.hx",lineNumber:1576,className:"DDLS.Mesh",methodName:"debug"})},
traverse:function(a,b){var c,d;d=new DDLS.FromMeshToVertices;d.set_fromMesh(this);var e;e=new DDLS.FromVertexToIncomingEdges;for(var f=new DDLS.ObjectMap;null!=(c=d.next());)if(f.set(c,!0),this.vertexIsInsideAABB(c,this))for(a(c),e.set_fromVertex(c);null!=(c=e.next());){var h=void 0,h=c.get_originVertex();(h=f.h[h.__id__])||b(c)}},vertexIsInsideAABB:function(a,b){return 0>a.get_pos().x||a.get_pos().x>b.get_width()||0>a.get_pos().y||a.get_pos().y>b.get_height()?!1:!0}};DDLS.GraphEdge=function(){this._id=DDLS.GraphEdgeID;DDLS.GraphEdgeID++};
DDLS.GraphEdge.prototype={get_id:function(){return this._id},dispose:function(){},get_prev:function(){return this._prev},set_prev:function(a){return this._prev=a},get_next:function(){return this._next},set_next:function(a){return this._next=a},get_rotPrevEdge:function(){return this._rotPrevEdge},set_rotPrevEdge:function(a){return this._rotPrevEdge=a},get_rotNextEdge:function(){return this._rotNextEdge},set_rotNextEdge:function(a){return this._rotNextEdge=a},get_oppositeEdge:function(){return this._oppositeEdge},
set_oppositeEdge:function(a){return this._oppositeEdge=a},get_sourceNode:function(){return this._sourceNode},set_sourceNode:function(a){return this._sourceNode=a},get_destinationNode:function(){return this._destinationNode},set_destinationNode:function(a){return this._destinationNode=a},get_data:function(){return this._data},set_data:function(a){return this._data=a}};DDLS.GraphNode=function(){this._id=DDLS.GraphNodeID;DDLS.GraphNodeID++;this._successorNodes=new DDLS.ObjectMap};
DDLS.GraphNode.prototype={get_id:function(){return this._id},dispose:function(){this._data=this._successorNodes=this._outgoingEdge=this._next=this._prev=null},get_prev:function(){return this._prev},set_prev:function(a){return this._prev=a},get_next:function(){return this._next},set_next:function(a){return this._next=a},get_outgoingEdge:function(){return this._outgoingEdge},set_outgoingEdge:function(a){return this._outgoingEdge=a},get_successorNodes:function(){return this._successorNodes},set_successorNodes:function(a){return this._successorNodes=
a},get_data:function(){return this._data},set_data:function(a){return this._data=a}};DDLS.Graph=function(){this._id=DDLS.GraphID;DDLS.GraphID++};
DDLS.Graph.prototype={get_id:function(){return this._id},get_edge:function(){return this._edge},get_node:function(){return this._node},dispose:function(){for(;null!=this._node;)this.deleteNode(this._node)},insertNode:function(){var a=new DDLS.GraphNode;null!=this._node&&(a.set_next(this._node),this._node.set_prev(a));return this._node=a},deleteNode:function(a){for(;null!=a.get_outgoingEdge();)null!=a.get_outgoingEdge().get_oppositeEdge()&&this.deleteEdge(a.get_outgoingEdge().get_oppositeEdge()),this.deleteEdge(a.get_outgoingEdge());
for(var b=this._node,c;null!=b;)c=b.get_successorNodes().get(a),null!=c&&this.deleteEdge(c),b=b.get_next();this._node==a?null!=a.get_next()?(a.get_next().set_prev(null),this._node=a.get_next()):this._node=null:null!=a.get_next()?(a.get_prev().set_next(a.get_next()),a.get_next().set_prev(a.get_prev())):a.get_prev().set_next(null);a.dispose()},insertEdge:function(a,b){if(null!=a.get_successorNodes().get(b))return null;var c=new DDLS.GraphEdge;null!=this._edge&&(this._edge.set_prev(c),c.set_next(this._edge));
this._edge=c;c.set_sourceNode(a);c.set_destinationNode(b);a.get_successorNodes().set(b,c);null!=a.get_outgoingEdge()&&(a.get_outgoingEdge().set_rotPrevEdge(c),c.set_rotNextEdge(a.get_outgoingEdge()));a.set_outgoingEdge(c);var d;d=b.get_successorNodes().get(a);null!=d&&(c.set_oppositeEdge(d),d.set_oppositeEdge(c));return c},deleteEdge:function(a){this._edge==a?null!=a.get_next()?(a.get_next().set_prev(null),this._edge=a.get_next()):this._edge=null:null!=a.get_next()?(a.get_prev().set_next(a.get_next()),
a.get_next().set_prev(a.get_prev())):a.get_prev().set_next(null);a.get_sourceNode().get_outgoingEdge()==a?null!=a.get_rotNextEdge()?(a.get_rotNextEdge().set_rotPrevEdge(null),a.get_sourceNode().set_outgoingEdge(a.get_rotNextEdge())):a.get_sourceNode().set_outgoingEdge(null):null!=a.get_rotNextEdge()?(a.get_rotPrevEdge().set_rotNextEdge(a.get_rotNextEdge()),a.get_rotNextEdge().set_rotPrevEdge(a.get_rotPrevEdge())):a.get_rotPrevEdge().set_rotNextEdge(null);a.dispose()}};DDLS.EdgeData=function(){};DDLS.NodeData=function(){};DDLS.Potrace={};DDLS.Potrace.MAX_INT=2147483647;DDLS.Potrace.maxDistance=1;
DDLS.Potrace.buildShapes=function(a,b,c){for(var d=[],e=new DDLS.StringMap,f=1,h=a.height-1;f<h;)for(var g=f++,k=0,n=a.width-1;k<n;){var m=k++;16777215==function(b){b=g*a.width+m<<2;return a.bytes.b[b+1]<<16|a.bytes.b[b+2]<<8|a.bytes.b[b+3]}(this)&&16777215>function(b){b=g*a.width+(m+1)<<2;return a.bytes.b[b+1]<<16|a.bytes.b[b+2]<<8|a.bytes.b[b+3]}(this)&&(e.get(m+1+"_"+g)||d.push(DDLS.Potrace.buildShape(a,g,m+1,e,b,c)))}return d};
DDLS.Potrace.buildShape=function(a,b,c,d,e,f){var h=c,g=b,k=[h,g];d.set(h+"_"+g,!0);for(var n=new DDLS.Point(0,1),m=new DDLS.Point,l,p,r=-1;;){if(null!=e){var q=b*e.width+c<<2;e.bytes.b[q]=255;e.bytes.b[q+1]=255;e.bytes.b[q+2]=0;e.bytes.b[q+3]=0}l=b+n.x+n.y|0;p=c+n.x-n.y|0;16777215>function(b){b=l*a.width+p<<2;return a.bytes.b[b+1]<<16|a.bytes.b[b+2]<<8|a.bytes.b[b+3]}(this)?(m.x=-n.y,m.y=n.x):(l=b+n.y|0,p=c+n.x|0,16777215>function(b){b=l*a.width+p<<2;return a.bytes.b[b+1]<<16|a.bytes.b[b+2]<<8|a.bytes.b[b+
3]}(this)?(m.x=n.x,m.y=n.y):(l=b,p=c,m.x=n.y,m.y=-n.x));h+=n.x;g+=n.y;if(h==k[0]&&g==k[1])break;else k.push(h),k.push(g),d.set(h+"_"+g,!0),b=l,c=p,n.x=m.x,n.y=m.y;r--;if(0==r)break}if(null!=f){f.graphics.lineStyle(0.5,65280,1);f.graphics.moveTo(k[0],k[1]);for(b=2;b<k.length;)f.graphics.lineTo(k[b],k[b+1]),b+=2;f.graphics.lineTo(k[0],k[1])}return k};
DDLS.Potrace.buildGraph=function(a){var b,c=new DDLS.Graph,d;for(b=0;b<a.length;)d=c.insertNode(),d.set_data(new DDLS.NodeData),d.get_data().index=b,d.get_data().point=new DDLS.Point(a[b],a[b+1]),b+=2;var e,f,h,g;for(a=c.get_node();null!=a;){for(b=null!=a.get_next()?a.get_next():c.get_node();b!=a;){g=!0;e=null!=a.get_next()?a.get_next():c.get_node();h=2;for(d=0;e!=b;){f=DDLS.Geom2D.distanceSquaredPointToSegment(e.get_data().point.x,e.get_data().point.y,a.get_data().point.x,a.get_data().point.y,b.get_data().point.x,
b.get_data().point.y);0>f&&(f=0);if(f>=DDLS.Potrace.maxDistance){g=!1;break}h++;d+=f;e=null!=e.get_next()?e.get_next():c.get_node()}if(!g)break;e=c.insertEdge(a,b);f=new DDLS.EdgeData;f.sumDistancesSquared=d;f.length=a.get_data().point.distanceTo(b.get_data().point);f.nodesCount=h;e.set_data(f);b=null!=b.get_next()?b.get_next():c.get_node()}a=a.get_next()}return c};
DDLS.Potrace.buildPolygon=function(a,b){var c=[],d,e=2147483647,f,h,g=null;for(d=a.get_node();d.get_data().index<e;){e=d.get_data().index;c.push(d.get_data().point.x);c.push(d.get_data().point.y);h=0;for(d=d.get_outgoingEdge();null!=d;)f=d.get_data().nodesCount-d.get_data().length*DDLS.sqrt(d.get_data().sumDistancesSquared/d.get_data().nodesCount),f>h&&(h=f,g=d),d=d.get_rotNextEdge();d=g.get_destinationNode()}0==DDLS.Geom2D.getDirection(c[c.length-2],c[c.length-1],c[0],c[1],c[2],c[3])&&(c.shift(),
c.shift());if(null!=b){b.graphics.lineStyle(0.5,255);b.graphics.moveTo(c[0],c[1]);for(e=2;e<c.length;)b.graphics.lineTo(c[e],c[e+1]),e+=2;b.graphics.lineTo(c[0],c[1])}return c};DDLS.ShapeSimplifier=function(a,b){null==b&&(b=1);var c=a.length;DDLS.Debug.assertFalse(0!=(c&1),"Wrong size",{fileName:"ShapeSimplifier.hx",lineNumber:18,className:"DDLS.ShapeSimplifier",methodName:"simplify"});if(4>=c)return[].concat(a);for(var d=a[0],e=a[1],f=a[c-2],h=a[c-1],g=-1,k=0,n=1,c=c>>1;n<c;){var m=n++,l=DDLS.Geom2D.distanceSquaredPointToSegment(a[m<<1],a[(m<<1)+1],d,e,f,h);l>k&&(k=l,g=m)}return k>b*b?(d=a.slice(0,(g<<1)+2),g=a.slice(g<<1),d=DDLS.ShapeSimplifier(d,b),g=DDLS.ShapeSimplifier(g,
b),d.slice(0,d.length-2).concat(g)):[d,e,f,h]};DDLS.AStar=function(){this.iterEdge=new DDLS.FromFaceToInnerEdges};
DDLS.AStar.prototype={dispose:function(){this.predecessor=this.scoreH=this.scoreG=this.scoreF=this.entryY=this.entryX=this.entryEdges=this.openedFaces=this.sortedOpenedFaces=this.closedFaces=this._mesh=null},get_radius:function(){return this._radius},set_radius:function(a){this._radius=a;this.radiusSquared=this._radius*this._radius;this.diameter=2*this._radius;this.diameterSquared=this.diameter*this.diameter},set_mesh:function(a){this._mesh=a},findPath:function(a,b,c,d,e,f){this.closedFaces=new DDLS.ObjectMap;
this.sortedOpenedFaces=[];this.openedFaces=new DDLS.ObjectMap;this.entryEdges=new DDLS.ObjectMap;this.entryX=new DDLS.ObjectMap;this.entryY=new DDLS.ObjectMap;this.scoreF=new DDLS.ObjectMap;this.scoreG=new DDLS.ObjectMap;this.scoreH=new DDLS.ObjectMap;this.predecessor=new DDLS.ObjectMap;var h;h=DDLS.Geom2D.locatePosition(a,b,this._mesh);switch(h[1]){case 0:return;case 1:h=h[2];if(h.get_isConstrained())return;this.fromFace=h.get_leftFace();break;case 2:this.fromFace=h[2]}h=DDLS.Geom2D.locatePosition(c,
d,this._mesh);switch(h[1]){case 0:h=h[2];this.toFace=h.get_edge().get_leftFace();break;case 1:h=h[2];this.toFace=h.get_leftFace();break;case 2:this.toFace=h[2]}this.sortedOpenedFaces.push(this.fromFace);this.entryEdges.set(this.fromFace,null);this.entryX.set(this.fromFace,a);this.entryY.set(this.fromFace,b);this.scoreG.set(this.fromFace,0);a=DDLS.sqrt((c-a)*(c-a)+(d-b)*(d-b));this.scoreH.set(this.fromFace,a);this.scoreF.set(this.fromFace,a);for(var g,k,n=new DDLS.Point,m=new DDLS.Point,l=new DDLS.Point,
p;;){if(0==this.sortedOpenedFaces.length){DDLS.Log("AStar no path found",{fileName:"AStar.hx",lineNumber:157,className:"DDLS.AStar",methodName:"findPath"});this.curFace=null;break}this.curFace=this.sortedOpenedFaces.pop();if(this.curFace==this.toFace)break;for(this.iterEdge.set_fromFace(this.curFace);null!=(a=this.iterEdge.next());)a.get_isConstrained()||(b=a.get_rightFace(),this.closedFaces.h[b.__id__]||this.curFace!=this.fromFace&&0<this._radius&&!this.isWalkableByRadius(this.entryEdges.h[this.curFace.__id__],
this.curFace,a)||(n.x=this.entryX.h[this.curFace.__id__],n.y=this.entryY.h[this.curFace.__id__],m.x=n.x,m.y=n.y,m.x=(a.get_originVertex().get_pos().x+a.get_destinationVertex().get_pos().x)/2,m.y=(a.get_originVertex().get_pos().y+a.get_destinationVertex().get_pos().y)/2,l.x=m.x-c,l.y=m.y-d,k=l.get_length(),l.x=n.x-m.x,l.y=n.y-m.y,g=this.scoreG.h[this.curFace.__id__]+l.get_length(),h=k+g,p=!1,null!=this.openedFaces.h[b.__id__]&&this.openedFaces.h[b.__id__]?this.scoreF.h[b.__id__]>h&&(p=!0):(this.sortedOpenedFaces.push(b),
this.openedFaces.set(b,!0),p=!0),p&&(this.entryEdges.set(b,a),this.entryX.set(b,m.x),this.entryY.set(b,m.y),this.scoreF.set(b,h),this.scoreG.set(b,g),this.scoreH.set(b,k),this.predecessor.set(b,this.curFace))));this.openedFaces.set(this.curFace,!1);this.closedFaces.set(this.curFace,!0);this.sortedOpenedFaces.sort(DDLS.Bind(this,this.sortingFaces))}if(null!=this.curFace)for(e.push(this.curFace);this.curFace!=this.fromFace;)f.unshift(this.entryEdges.h[this.curFace.__id__]),this.curFace=this.predecessor.h[this.curFace.__id__],
e.unshift(this.curFace)},sortingFaces:function(a,b){return this.scoreF.h[a.__id__]==this.scoreF.h[b.__id__]?0:this.scoreF.h[a.__id__]<this.scoreF.h[b.__id__]?1:-1},isWalkableByRadius:function(a,b,c){var d=null,e=null,f=null;a.get_originVertex()==c.get_originVertex()?(d=a.get_destinationVertex(),e=c.get_destinationVertex(),f=a.get_originVertex()):a.get_destinationVertex()==c.get_destinationVertex()?(d=a.get_originVertex(),e=c.get_originVertex(),f=a.get_destinationVertex()):a.get_originVertex()==c.get_destinationVertex()?
(d=a.get_destinationVertex(),e=c.get_originVertex(),f=a.get_originVertex()):a.get_destinationVertex()==c.get_originVertex()&&(d=a.get_originVertex(),e=c.get_destinationVertex(),f=a.get_destinationVertex());var h;h=(f.get_pos().x-d.get_pos().x)*(e.get_pos().x-d.get_pos().x)+(f.get_pos().y-d.get_pos().y)*(e.get_pos().y-d.get_pos().y);if(0>=h)return f=(f.get_pos().x-d.get_pos().x)*(f.get_pos().x-d.get_pos().x)+(f.get_pos().y-d.get_pos().y)*(f.get_pos().y-d.get_pos().y),f>=this.diameterSquared?!0:!1;
h=(f.get_pos().x-e.get_pos().x)*(d.get_pos().x-e.get_pos().x)+(f.get_pos().y-e.get_pos().y)*(d.get_pos().y-e.get_pos().y);if(0>=h)return f=(f.get_pos().x-e.get_pos().x)*(f.get_pos().x-e.get_pos().x)+(f.get_pos().y-e.get_pos().y)*(f.get_pos().y-e.get_pos().y),f>=this.diameterSquared?!0:!1;c=b.get_edge()!=a&&b.get_edge().get_oppositeEdge()!=a&&b.get_edge()!=c&&b.get_edge().get_oppositeEdge()!=c?b.get_edge():b.get_edge().get_nextLeftEdge()!=a&&b.get_edge().get_nextLeftEdge().get_oppositeEdge()!=a&&b.get_edge().get_nextLeftEdge()!=
c&&b.get_edge().get_nextLeftEdge().get_oppositeEdge()!=c?b.get_edge().get_nextLeftEdge():b.get_edge().get_prevLeftEdge();if(c.get_isConstrained())return e=new DDLS.Point(f.get_pos().x,f.get_pos().y),DDLS.Geom2D.projectOrthogonaly(e,c),f=(e.x-f.get_pos().x)*(e.x-f.get_pos().x)+(e.y-f.get_pos().y)*(e.y-f.get_pos().y),f>=this.diameterSquared?!0:!1;d=(f.get_pos().x-d.get_pos().x)*(f.get_pos().x-d.get_pos().x)+(f.get_pos().y-d.get_pos().y)*(f.get_pos().y-d.get_pos().y);e=(f.get_pos().x-e.get_pos().x)*
(f.get_pos().x-e.get_pos().x)+(f.get_pos().y-e.get_pos().y)*(f.get_pos().y-e.get_pos().y);if(d<this.diameterSquared||e<this.diameterSquared)return!1;e=[];d=[];a=new DDLS.ObjectMap;d.push(c);c.get_leftFace()==b?(e.push(c.get_rightFace()),b=c.get_rightFace()):(e.push(c.get_leftFace()),b=c.get_leftFace());a.set(b,!0);for(var g;0<e.length;){b=e.shift();c=d.shift();b.get_edge()==c||b.get_edge()==c.get_oppositeEdge()?(c=b.get_edge().get_nextLeftEdge(),g=b.get_edge().get_nextLeftEdge().get_nextLeftEdge()):
b.get_edge().get_nextLeftEdge()==c||b.get_edge().get_nextLeftEdge()==c.get_oppositeEdge()?(c=b.get_edge(),g=b.get_edge().get_nextLeftEdge().get_nextLeftEdge()):(c=b.get_edge(),g=b.get_edge().get_nextLeftEdge());h=c.get_leftFace()==b?c.get_rightFace():c.get_leftFace();b=g.get_leftFace()==b?g.get_rightFace():g.get_leftFace();if(!a.h[h.__id__]&&DDLS.Geom2D.distanceSquaredVertexToEdge(f,c)<this.diameterSquared){if(c.get_isConstrained())return!1;e.push(h);d.push(c);a.set(h,!0)}if(!a.h[b.__id__]&&DDLS.Geom2D.distanceSquaredVertexToEdge(f,
g)<this.diameterSquared){if(g.get_isConstrained())return!1;e.push(b);d.push(g);a.set(b,!0)}}return!0}};DDLS.EntityAI=function(){this._radius=10;this.x=this.y=0;this.dirNormX=1;this.dirNormY=0;this.angleFOV=60};
DDLS.EntityAI.prototype={buildApproximation:function(){this._approximateObject=new DDLS.Object;this._approximateObject.get_matrix().translate(this.x,this.y);var a=[];this._approximateObject.set_coordinates(a);if(0!=this._radius)for(var b=0;6>b;){var c=b++;a.push(this._radius*DDLS.cos(DDLS.TwoPI*c/6));a.push(this._radius*DDLS.sin(DDLS.TwoPI*c/6));a.push(this._radius*DDLS.cos(DDLS.TwoPI*(c+1)/6));a.push(this._radius*DDLS.sin(DDLS.TwoPI*(c+1)/6))}},get_approximateObject:function(){this._approximateObject.get_matrix().identity();
this._approximateObject.get_matrix().translate(this.x,this.y);return this._approximateObject},get_radius:function(){return this._radius},get_radiusSquared:function(){return this._radiusSquared},set_radius:function(a){this._radius=a;this._radiusSquared=this._radius*this._radius;return a}};DDLS.EntityAI.NUM_SEGMENTS=6;DDLS.Funnel=function(){this._currPoolPointsIndex=0;this._poolPointsSize=3E3;this._numSamplesCircle=16;this._radius=this._radiusSquared=0;this._poolPoints=[];for(var a=0,b=this._poolPointsSize;a<b;)a++,this._poolPoints.push(new DDLS.Point)};
DDLS.Funnel.prototype={dispose:function(){this._sampleCircle=null},getPoint:function(a,b){null==b&&(b=0);null==a&&(a=0);this.__point=this._poolPoints[this._currPoolPointsIndex];this.__point.setXY(a,b);this._currPoolPointsIndex++;this._currPoolPointsIndex==this._poolPointsSize&&(this._poolPoints.push(new DDLS.Point),this._poolPointsSize++);return this.__point},getCopyPoint:function(a){return this.getPoint(a.x,a.y)},get_radius:function(){return this._radius},set_radius:function(a){this._radius=DDLS.max(0,
a);this._radiusSquared=this._radius*this._radius;this._sampleCircle=[];if(0==this.get_radius())return 0;a=0;for(var b=this._numSamplesCircle;a<b;){var c=a++;this._sampleCircle.push(new DDLS.Point(this._radius*DDLS.cos(-DDLS.TwoPI*c/this._numSamplesCircle),this._radius*DDLS.sin(-DDLS.TwoPI*c/this._numSamplesCircle)))}this._sampleCircleDistanceSquared=(this._sampleCircle[0].x-this._sampleCircle[1].x)*(this._sampleCircle[0].x-this._sampleCircle[1].x)+(this._sampleCircle[0].y-this._sampleCircle[1].y)*
(this._sampleCircle[0].y-this._sampleCircle[1].y);return this._radius},findPath:function(a,b,c,d,e,f,h){this._currPoolPointsIndex=0;if(0<this._radius){var g=e[0],k,n,m;n=g.get_edge().get_originVertex().get_pos();m=g.get_edge().get_destinationVertex().get_pos();g=g.get_edge().get_nextLeftEdge().get_destinationVertex().get_pos();k=(n.x-a)*(n.x-a)+(n.y-b)*(n.y-b);k<=this._radiusSquared?(k=DDLS.sqrt(k),a=(a-n.x)/k*this._radius*1.01+n.x,b=(b-n.y)/k*this._radius*1.01+n.y):(k=(m.x-a)*(m.x-a)+(m.y-b)*(m.y-
b),k<=this._radiusSquared?(k=DDLS.sqrt(k),a=(a-m.x)/k*this._radius*1.01+m.x,b=(b-m.y)/k*this._radius*1.01+m.y):(k=(g.x-a)*(g.x-a)+(g.y-b)*(g.y-b),k<=this._radiusSquared&&(k=DDLS.sqrt(k),a=(a-g.x)/k*this._radius*1.01+g.x,b=(b-g.y)/k*this._radius*1.01+g.y)));g=e[e.length-1];n=g.get_edge().get_originVertex().get_pos();m=g.get_edge().get_destinationVertex().get_pos();g=g.get_edge().get_nextLeftEdge().get_destinationVertex().get_pos();k=(n.x-c)*(n.x-c)+(n.y-d)*(n.y-d);k<=this._radiusSquared?(k=DDLS.sqrt(k),
c=(c-n.x)/k*this._radius*1.01+n.x,d=(d-n.y)/k*this._radius*1.01+n.y):(k=(m.x-c)*(m.x-c)+(m.y-d)*(m.y-d),k<=this._radiusSquared?(k=DDLS.sqrt(k),c=(c-m.x)/k*this._radius*1.01+m.x,d=(d-m.y)/k*this._radius*1.01+m.y):(k=(g.x-c)*(g.x-c)+(g.y-d)*(g.y-d),k<=this._radiusSquared&&(k=DDLS.sqrt(k),c=(c-g.x)/k*this._radius*1.01+g.x,d=(d-g.y)/k*this._radius*1.01+g.y)))}var l;l=new DDLS.Point(a,b);n=new DDLS.Point(c,d);if(1==e.length)h.push(l.x),h.push(l.y),h.push(n.x),h.push(n.y);else{var p=null,r=null;m=DDLS.Geom2D.isInFace(a,
b,e[0]);switch(m[1]){case 1:f[0]==m[2]&&(f.shift(),e.shift())}g=[];k=[];g.push(l);k.push(l);var q=new DDLS.ObjectMap,s=[];e=new DDLS.ObjectMap;m=new DDLS.ObjectMap;e.set(l,0);var p=f[0],t=DDLS.Geom2D.getRelativePosition2(a,b,p),v;b=this.getCopyPoint(p.get_destinationVertex().get_pos());v=this.getCopyPoint(p.get_originVertex().get_pos());s.push(b);s.push(v);m.set(l,b);m.set(b,v);a=v;1==t?(e.set(b,1),e.set(v,-1),b=p.get_destinationVertex(),q.set(b,1),p=p.get_originVertex(),q.set(p,-1)):-1==t&&(e.set(b,
-1),e.set(v,1),b=p.get_destinationVertex(),q.set(b,-1),p=p.get_originVertex(),q.set(p,1));t=f[0].get_originVertex();b=f[0].get_destinationVertex();v=1;for(var u=f.length;v<u;)p=v++,p=f[p],p.get_originVertex()==t?r=p.get_destinationVertex():p.get_destinationVertex()==t?r=p.get_originVertex():p.get_originVertex()==b?(r=p.get_destinationVertex(),t=b):p.get_destinationVertex()==b?(r=p.get_originVertex(),t=b):DDLS.Log("IMPOSSIBLE TO IDENTIFY THE VERTEX !!!",{fileName:"Funnel.hx",lineNumber:286,className:"DDLS.Funnel",
methodName:"findPath"}),b=this.getCopyPoint(r.get_pos()),s.push(b),p=-q.h[t.__id__],e.set(b,p),m.set(a,b),q.set(r,p),a=b,b=t,t=r;m.set(a,n);e.set(n,0);f=[];r=new DDLS.ObjectMap;f.push(l);r.set(l,0);q=0;for(a=s.length;q<a;)if(l=q++,b=s[l],-1==e.h[b.__id__]){for(l=g.length-2;0<=l;){p=DDLS.Geom2D.getDirection(g[l].x,g[l].y,g[l+1].x,g[l+1].y,b.x,b.y);if(-1!=p){g.shift();for(p=0;p<l;)p++,f.push(g[0]),r.set(g[0],1),g.shift();f.push(g[0]);r.set(g[0],1);k.splice(0,k.length);k.push(g[0]);k.push(b);break}l--}k.push(b);
for(l=k.length-3;0<=l;){p=DDLS.Geom2D.getDirection(k[l].x,k[l].y,k[l+1].x,k[l+1].y,b.x,b.y);if(-1==p)break;else k.splice(l+1,1);l--}}else{for(l=k.length-2;0<=l;){p=DDLS.Geom2D.getDirection(k[l].x,k[l].y,k[l+1].x,k[l+1].y,b.x,b.y);if(1!=p){k.shift();for(p=0;p<l;)p++,f.push(k[0]),r.set(k[0],-1),k.shift();f.push(k[0]);r.set(k[0],-1);g.splice(0,g.length);g.push(k[0]);g.push(b);break}l--}g.push(b);for(l=g.length-3;0<=l;){p=DDLS.Geom2D.getDirection(g[l].x,g[l].y,g[l+1].x,g[l+1].y,b.x,b.y);if(1==p)break;
else g.splice(l+1,1);l--}}s=!1;for(l=k.length-2;0<=l;){p=DDLS.Geom2D.getDirection(k[l].x,k[l].y,k[l+1].x,k[l+1].y,c,d);if(1!=p){k.shift();s=0;for(l+=1;s<l;)s++,f.push(k[0]),r.set(k[0],-1),k.shift();f.push(n);r.set(n,0);s=!0;break}l--}if(!s)for(l=g.length-2;0<=l;){p=DDLS.Geom2D.getDirection(g[l].x,g[l].y,g[l+1].x,g[l+1].y,c,d);if(-1!=p){g.shift();c=0;for(d=l+1;c<d;)c++,f.push(g[0]),r.set(g[0],1),g.shift();f.push(n);r.set(n,0);s=!0;break}l--}s||(f.push(n),r.set(n,0));c=[];if(0<this.get_radius()){d=
[];if(2==f.length)this.adjustWithTangents(f[0],!1,f[1],!1,e,m,d,c);else if(2<f.length){this.adjustWithTangents(f[0],!1,f[1],!0,e,m,d,c);if(3<f.length)for(g=1,k=f.length-3+1;g<k;)s=g++,this.adjustWithTangents(f[s],!0,f[s+1],!0,e,m,d,c);g=f.length;this.adjustWithTangents(f[g-2],!0,f[g-1],!1,e,m,d,c)}d.push(n);this.checkAdjustedPath(d,c,e);m=[];for(n=d.length-2;1<=n;){for(this.smoothAngle(c[2*n-1],d[n],c[2*n],e.h[d[n].__id__],m);0!=m.length;)g=2*n,c.splice(g,0),k=m.pop(),c.splice(g,0,k);n--}}else c=
f;e=0;for(n=c.length;e<n;)d=e++,h.push(c[d].x),h.push(c[d].y)}},adjustWithTangents:function(a,b,c,d,e,f,h,g){var k=[],n=e.h[a.__id__],m=e.h[c.__id__],l=null,p=null;if(b||d)if(b)if(d)if(1==n&&1==m)DDLS.Geom2D.tangentsParalCircleToCircle(this._radius,a.x,a.y,c.x,c.y,k),l=this.getPoint(k[2],k[3]),p=this.getPoint(k[4],k[5]);else if(-1==n&&-1==m)DDLS.Geom2D.tangentsParalCircleToCircle(this._radius,a.x,a.y,c.x,c.y,k),l=this.getPoint(k[0],k[1]),p=this.getPoint(k[6],k[7]);else if(1==n&&-1==m)if(DDLS.Geom2D.tangentsCrossCircleToCircle(this._radius,
a.x,a.y,c.x,c.y,k))l=this.getPoint(k[2],k[3]),p=this.getPoint(k[6],k[7]);else{DDLS.Log("NO TANGENT, points are too close for radius",{fileName:"Funnel.hx",lineNumber:642,className:"DDLS.Funnel",methodName:"adjustWithTangents"});return}else if(DDLS.Geom2D.tangentsCrossCircleToCircle(this._radius,a.x,a.y,c.x,c.y,k))l=this.getPoint(k[0],k[1]),p=this.getPoint(k[4],k[5]);else{DDLS.Log("NO TANGENT, points are too close for radius",{fileName:"Funnel.hx",lineNumber:659,className:"DDLS.Funnel",methodName:"adjustWithTangents"});
return}else if(DDLS.Geom2D.tangentsPointToCircle(c.x,c.y,a.x,a.y,this._radius,k))0<k.length&&(l=1==n?this.getPoint(k[0],k[1]):this.getPoint(k[2],k[3]),p=c);else{DDLS.Log("NO TANGENT",{fileName:"Funnel.hx",lineNumber:605,className:"DDLS.Funnel",methodName:"adjustWithTangents"});return}else if(DDLS.Geom2D.tangentsPointToCircle(a.x,a.y,c.x,c.y,this._radius,k))1==m?(l=a,p=this.getPoint(k[2],k[3])):(l=a,p=this.getPoint(k[0],k[1]));else{DDLS.Log("NO TANGENT",{fileName:"Funnel.hx",lineNumber:580,className:"DDLS.Funnel",
methodName:"adjustWithTangents"});return}else l=a,p=c;for(k=f.h[a.__id__];k!=c;){n=DDLS.Geom2D.distanceSquaredPointToSegment(k.x,k.y,l.x,l.y,p.x,p.y);if(n<this._radiusSquared){this.adjustWithTangents(a,b,k,!0,e,f,h,g);this.adjustWithTangents(k,!0,c,d,e,f,h,g);return}k=f.h[k.__id__]}g.push(l);g.push(p);h.push(a)},checkAdjustedPath:function(a,b,c){for(var d=!0,e,f,h,g,k,n,m,l=[],p=null,r=null;d;)for(var d=!1,q=2;q<a.length;)g=a[q],k=c.h[g.__id__],e=a[q-1],h=c.h[e.__id__],e=a[q-2],f=c.h[e.__id__],h==
k&&(h=b[2*(q-2)],n=b[2*(q-1)-1],m=b[2*(q-1)],h=(h.x-n.x)*(m.x-n.x)+(h.y-n.y)*(m.y-n.y),0<h&&(2==q?(DDLS.Geom2D.tangentsPointToCircle(e.x,e.y,g.x,g.y,this._radius,l),1==k?(p=e,r=this.getPoint(l[2],l[3])):(p=e,r=this.getPoint(l[0],l[1]))):q==a.length-1?(DDLS.Geom2D.tangentsPointToCircle(g.x,g.y,e.x,e.y,this._radius,l),p=1==f?this.getPoint(l[0],l[1]):this.getPoint(l[2],l[3]),r=g):1==f&&-1==k?(DDLS.Geom2D.tangentsCrossCircleToCircle(this._radius,e.x,e.y,g.x,g.y,l),p=this.getPoint(l[2],l[3]),r=this.getPoint(l[6],
l[7])):-1==f&&1==k?(DDLS.Geom2D.tangentsCrossCircleToCircle(this._radius,e.x,e.y,g.x,g.y,l),p=this.getPoint(l[0],l[1]),r=this.getPoint(l[4],l[5])):1==f&&1==k?(DDLS.Geom2D.tangentsParalCircleToCircle(this._radius,e.x,e.y,g.x,g.y,l),p=this.getPoint(l[2],l[3]),r=this.getPoint(l[4],l[5])):-1==f&&-1==k&&(DDLS.Geom2D.tangentsParalCircleToCircle(this._radius,e.x,e.y,g.x,g.y,l),p=this.getPoint(l[0],l[1]),r=this.getPoint(l[6],l[7])),g=2*(q-2),b.splice(g,1),b.splice(g,0,p),g=2*q-1,b.splice(g,1),b.splice(g,
0,r),a.splice(q-1,1),b.splice(2*(q-1)-1,2),l.splice(0,l.length),q--)),q++},smoothAngle:function(a,b,c,d,e){var f=DDLS.Geom2D.getDirection(a.x,a.y,b.x,b.y,c.x,c.y);if(!((a.x-c.x)*(a.x-c.x)+(a.y-c.y)*(a.y-c.y)<=this._sampleCircleDistanceSquared)){for(var h=0,g,k,n,m,l,p=0,r=this._numSamplesCircle;p<r;){g=p++;n=!1;m=b.x+this._sampleCircle[g].x;l=b.y+this._sampleCircle[g].y;g=DDLS.Geom2D.getDirection(a.x,a.y,b.x,b.y,m,l);k=DDLS.Geom2D.getDirection(b.x,b.y,c.x,c.y,m,l);if(1==d)if(-1==f)-1==g&&-1==k&&(n=
!0);else{if(-1==g||-1==k)n=!0}else if(1==f)1==g&&1==k&&(n=!0);else if(1==g||1==k)n=!0;n?(e.splice(h,0),n=new DDLS.Point(m,l),e.splice(h,0,n),h++):h=0}-1==d&&e.reverse()}}};DDLS.PathFinder=function(){this.astar=new DDLS.AStar;this.funnel=new DDLS.Funnel;this.listFaces=[];this.listEdges=[]};
DDLS.PathFinder.prototype={dispose:function(){this._mesh=null;this.astar.dispose();this.astar=null;this.funnel.dispose();this.listFaces=this.listEdges=this.funnel=null},get_mesh:function(){return this._mesh},set_mesh:function(a){this._mesh=a;this.astar.set_mesh(this._mesh);return a},findPath:function(a,b,c){c.splice(0,c.length);DDLS.Debug.assertFalse(null==this._mesh,"Mesh missing",{fileName:"PathFinder.hx",lineNumber:51,className:"DDLS.PathFinder",methodName:"findPath"});DDLS.Debug.assertFalse(null==
this.entity,"Entity missing",{fileName:"PathFinder.hx",lineNumber:52,className:"DDLS.PathFinder",methodName:"findPath"});DDLS.Geom2D.isCircleIntersectingAnyConstraint(a,b,this.entity.get_radius(),this._mesh)||(this.astar.set_radius(this.entity.get_radius()),this.funnel.set_radius(this.entity.get_radius()),this.listFaces.splice(0,this.listFaces.length),this.listEdges.splice(0,this.listEdges.length),this.astar.findPath(this.entity.x,this.entity.y,a,b,this.listFaces,this.listEdges),0==this.listFaces.length?
DDLS.Log("PathFinder listFaces.length == 0",{fileName:"PathFinder.hx",lineNumber:63,className:"DDLS.PathFinder",methodName:"findPath"}):this.funnel.findPath(this.entity.x,this.entity.y,a,b,this.listFaces,this.listEdges,c))}};DDLS.FieldOfView=function(){this._mesh=this._fromEntity=null;this._debug=!1};
DDLS.FieldOfView.prototype={get_fromEntity:function(){return this._fromEntity},set_fromeEntity:function(a){this._fromEntity=a},set_mesh:function(a){this._mesh=a},isInField:function(a){if(this._mesh&&this._fromEntity){var b=this._fromEntity.x,c=this._fromEntity.y,d=this._fromEntity.dirNormX,e=this._fromEntity.dirNormY,f=this._fromEntity.radiusFOV,h=this._fromEntity.angleFOV,g=a.x,k=a.y;a=a.radius;var n=(b-g)*(b-g)+(c-k)*(c-k);if(n>=(f+a)*(f+a))return!1;if(n<a*a)return!0;var m,l,p,r,n=[];DDLS.Geom2D.intersections2Circles(b,
c,f,g,k,a,n)&&(m=n[0],l=n[1],p=n[2],r=n[3]);var f=0.5*(b+g),q=0.5*(c+k);if(0==n.length||(f-g)*(f-g)+(q-k)*(q-k)<(f-m)*(f-m)+(q-l)*(q-l))n.splice(0,n.length),DDLS.Geom2D.tangentsPointToCircle(b,c,g,k,a,n),m=n[0],l=n[1],p=n[2],r=n[3];this._debug&&(this._debug.graphics.lineStyle(1,255),this._debug.graphics.drawCircle(m,l,2),this._debug.graphics.lineStyle(1,16711680),this._debug.graphics.drawCircle(p,r,2));k=DDLS.cos(this._fromEntity.angleFOV/2);g=m-b;a=l-c;f=DDLS.sqrt(g*g+a*a);g=g/f*d+a/f*e>k?!0:!1;
a=p-b;f=r-c;n=DDLS.sqrt(a*a+f*f);a=a/n*d+f/n*e>k?!0:!1;if(!(g||a||1==DDLS.Geom2D.getDirection(b,c,b+d,c+e,m,l)&&-1==DDLS.Geom2D.getDirection(b,c,b+d,c+e,p,r)))return!1;g&&a||(k=new DDLS.Point,d=DDLS.atan2(e,d),g||(e=DDLS.cos(d-h/2),g=DDLS.sin(d-h/2),DDLS.Geom2D.intersections2segments(b,c,b+e,c+g,m,l,p,r,k,null,!0),this._debug&&(this._debug.graphics.lineStyle(1,255),this._debug.graphics.drawCircle(k.x,k.y,2)),m=k.x,l=k.y),a||(e=DDLS.cos(d+h/2),h=DDLS.sin(d+h/2),DDLS.Geom2D.intersections2segments(b,
c,b+e,c+h,m,l,p,r,k,null,!0),this._debug&&(this._debug.graphics.lineStyle(1,16711680),this._debug.graphics.drawCircle(k.x,k.y,2)),p=k.x,r=k.y));this._debug&&(this._debug.graphics.lineStyle(1,0),this._debug.graphics.moveTo(b,c),this._debug.graphics.lineTo(m,l),this._debug.graphics.lineTo(p,r),this._debug.graphics.lineTo(b,c));var h=new DDLS.ObjectMap,d=new DDLS.ObjectMap,e=[],g=DDLS.Geom2D.locatePosition(b,c,this._mesh),s;g instanceof DDLS.Face?s=g:g instanceof DDLS.Edge?s=g.get_leftFace():g instanceof
DDLS.Vertex&&(s=g.get_edge().get_leftFace());g=[];k=new DDLS.ObjectMap;g.push(s);k[s]=!0;var t,v;s=new DDLS.Point;a=new DDLS.Point;for(var u,w,f=[],n=[];0<g.length;)for(q=g.shift(),k[q]=null,h[q]=!0,q=q.edge,d[q]||d[q.oppositeEdge]||(n.push(q),d[q]=!0),q=q.nextLeftEdge,d[q]||d[q.oppositeEdge]||(n.push(q),d[q]=!0),q=q.nextLeftEdge,d[q]||d[q.oppositeEdge]||(n.push(q),d[q]=!0);0<n.length;)if(q=n.pop(),t=q.originVertex.pos,v=q.destinationVertex.pos,DDLS.Geom2D.clipSegmentByTriangle(t.x,t.y,v.x,v.y,b,
c,p,r,m,l,s,a)){if(q.isConstrained){this._debug&&(this._debug.graphics.lineStyle(6,16776960),this._debug.graphics.moveTo(s.x,s.y),this._debug.graphics.lineTo(a.x,a.y));f.splice(0,f.length);DDLS.Geom2D.intersections2segments(b,c,s.x,s.y,m,l,p,r,null,f,!0);DDLS.Geom2D.intersections2segments(b,c,a.x,a.y,m,l,p,r,null,f,!0);t=f[1];u=f[3];u<t&&(t=u,u=f[1]);for(w=e.length-1;0<=w&&!(u>=e[w]);w--);v=w+1;0==v%2&&e.splice(v,0,u);for(w=0;w<e.length&&!(t<=e[w]);w++);u=w;0==u%2?(e.splice(u,0,t),v++):u--;e.splice(u+
1,v-u-1);if(2==e.length&&-DDLS.EPSILON<e[0]&&e[0]<DDLS.EPSILON&&1-DDLS.EPSILON<e[1]&&e[1]<1+DDLS.EPSILON)return!1}q=q.rightFace;k[q]||h[q]||(g.push(q),k[q]=!0)}if(this._debug)for(this._debug.graphics.lineStyle(3,65535),w=0;w<e.length;w+=2)this._debug.graphics.moveTo(m+e[w]*(p-m),l+e[w]*(r-l)),this._debug.graphics.lineTo(m+e[w+1]*(p-m),l+e[w+1]*(r-l));return!0}}};DDLS.LinearPathSampler=function(){this._samplingDistance=this._samplingDistanceSquared=1;this._preCompX=[];this._preCompY=[]};DDLS.LinearPathSampler.pythag=function(a,b){return DDLS.sqrt(a*a+b*b)};
DDLS.LinearPathSampler.prototype={dispose:function(){this._preCompY=this._preCompX=this._path=this.entity=null},get_x:function(){return this._currentX},get_y:function(){return this._currentY},get_hasPrev:function(){return this._hasPrev},get_hasNext:function(){return this._hasNext},get_count:function(){return this._count},set_count:function(a){this._count=a;0>this._count&&(this._count=0);this._count>this.get_countMax()-1&&(this._count=this.get_countMax()-1);this._hasPrev=0==this._count?!1:!0;this._count==
this.get_countMax()-1?this._hasNext=!1:this._hasNext=!0;this._currentX=this._preCompX[this._count];this._currentY=this._preCompY[this._count];this.updateEntity();return this._count},get_countMax:function(){return this._preCompX.length-1},get_samplingDistance:function(){return this._samplingDistance},set_samplingDistance:function(a){this._samplingDistance=a;this._samplingDistanceSquared=this._samplingDistance*this._samplingDistance;return a},set_path:function(a){this._path=a;this._preComputed=!1;this.reset();
return a},reset:function(){0<this._path.length?(DDLS.Debug.assertTrue(0==(this._path.length&1),"Wrong length",{fileName:"LinearPathSampler.hx",lineNumber:100,className:"DDLS.LinearPathSampler",methodName:"reset"}),this._currentX=this._path[0],this._currentY=this._path[1],this._iPrev=0,this._iNext=2,this._hasPrev=!1,this._hasNext=!0,this._count=0,this.updateEntity()):(this._hasNext=this._hasPrev=!1,this._count=0)},preCompute:function(){this._preCompX.splice(0,this._preCompX.length);this._preCompY.splice(0,
this._preCompY.length);this._count=0;this._preCompX.push(this._currentX);this._preCompY.push(this._currentY);for(this._preComputed=!1;this.next();)this._preCompX.push(this._currentX),this._preCompY.push(this._currentY);this.reset();this._preComputed=!0},prev:function(){if(!this._hasPrev)return!1;this._hasNext=!0;if(this._preComputed)return this._count--,0==this._count&&(this._hasPrev=!1),this._currentX=this._preCompX[this._count],this._currentY=this._preCompY[this._count],this.updateEntity(),!0;var a,
b;for(a=this._samplingDistance;;)if(b=DDLS.LinearPathSampler.pythag(this._currentX-this._path[this._iPrev],this._currentY-this._path[this._iPrev+1]),b<a){if(a-=b,this._iPrev-=2,this._iNext-=2,0==this._iNext)break}else break;0==this._iNext?(this._currentX=this._path[0],this._currentY=this._path[1],this._hasPrev=!1,this._iNext=2,this._iPrev=0):(this._currentX+=(this._path[this._iPrev]-this._currentX)*a/b,this._currentY+=(this._path[this._iPrev+1]-this._currentY)*a/b);this.updateEntity();return!0},next:function(){if(!this._hasNext)return!1;
this._hasPrev=!0;if(this._preComputed)return this._count++,this._count==this._preCompX.length-1&&(this._hasNext=!1),this._currentX=this._preCompX[this._count],this._currentY=this._preCompY[this._count],this.updateEntity(),!0;var a,b;for(a=this._samplingDistance;;)if(b=DDLS.LinearPathSampler.pythag(this._currentX-this._path[this._iNext],this._currentY-this._path[this._iNext+1]),b<a){if(a-=b,this._currentX=this._path[this._iNext],this._currentY=this._path[this._iNext+1],this._iPrev+=2,this._iNext+=
2,this._iNext==this._path.length)break}else break;this._iNext==this._path.length?(this._currentX=this._path[this._iPrev],this._currentY=this._path[this._iPrev+1],this._hasNext=!1,this._iNext=this._path.length-2,this._iPrev=this._iNext-2):(this._currentX+=(this._path[this._iNext]-this._currentX)*a/b,this._currentY+=(this._path[this._iNext+1]-this._currentY)*a/b);this.updateEntity();return!0},updateEntity:function(){null!=this.entity&&(DDLS.Debug.assertFalse(DDLS.isNaN(this._currentX)&&DDLS.isNaN(this._currentY),
null,{fileName:"LinearPathSampler.hx",lineNumber:228,className:"DDLS.LinearPathSampler",methodName:"updateEntity"}),this.entity.x=this._currentX,this.entity.y=this._currentY)}};DDLS.PathIterator=function(){this._entity=null;this._currentY=this._currentX=0;this._hasNext=this._hasPrev=!1;this._path=[];this._countMax=this._count=0};
DDLS.PathIterator.prototype={get_entity:function(){return this._entity},set_entity:function(a){this._entity=a},get_x:function(){return this._currentX},get_y:function(){return this._currentY},get_hasPrev:function(){return this._hasPrev},get_hasNext:function(){return this._hasNext},get_count:function(){return this._count},get_countMax:function(){return this._countMax},set_path:function(a){this._path=a;this._countMax=this._path.length/2;this.reset()},reset:function(){this._count=0;this._currentX=this._path[this._count];
this._currentY=this._path[this._count+1];this.updateEntity();this._hasPrev=!1;this._hasNext=2<this._path.length?!0:!1},prev:function(){if(!this._hasPrev)return!1;this._hasNext=!0;this._count--;this._currentX=this._path[2*this._count];this._currentY=this._path[2*this._count+1];this.updateEntity();0==this._count&&(this._hasPrev=!1);return!0},next:function(){if(!this._hasNext)return!1;this._hasPrev=!0;this._count++;this._currentX=this._path[2*this._count];this._currentY=this._path[2*this._count+1];this.updateEntity();
2*(this._count+1)==this._path.length&&(this._hasNext=!1);return!0},updateEntity:function(){this._entity&&(this._entity.x=this._currentX,this._entity.y=this._currentY)}};DDLS.RectMesh={};
DDLS.RectMesh=function(a,b){for(var c=[],d=[],e=[],f=[],h=4;h--;)e.push(new DDLS.Face),c.push(new DDLS.Vertex),f.push(new DDLS.Segment);for(h=12;h--;)d.push(new DDLS.Edge);h=new DDLS.Shape;c[0].get_pos().setXY(-10,-10);c[1].get_pos().setXY(a+10,-10);c[2].get_pos().setXY(a+10,b+10);c[3].get_pos().setXY(-10,b+10);c[0].setDatas(d[0]);c[1].setDatas(d[2]);c[2].setDatas(d[4]);c[3].setDatas(d[6]);d[0].setDatas(c[0],d[1],d[2],e[3],!0,!0);d[1].setDatas(c[1],d[0],d[7],e[0],!0,!0);d[2].setDatas(c[1],d[3],d[11],
e[3],!0,!0);d[3].setDatas(c[2],d[2],d[8],e[1],!0,!0);d[4].setDatas(c[2],d[5],d[6],e[2],!0,!0);d[5].setDatas(c[3],d[4],d[3],e[1],!0,!0);d[6].setDatas(c[3],d[7],d[10],e[2],!0,!0);d[7].setDatas(c[0],d[6],d[9],e[0],!0,!0);d[8].setDatas(c[1],d[9],d[5],e[1],!0,!1);d[9].setDatas(c[3],d[8],d[1],e[0],!0,!1);d[10].setDatas(c[0],d[11],d[4],e[2],!1,!1);d[11].setDatas(c[2],d[10],d[0],e[3],!1,!1);e[0].setDatas(d[9]);e[1].setDatas(d[8]);e[2].setDatas(d[4],!1);e[3].setDatas(d[2],!1);c[0].set_fromConstraintSegments([f[0],
f[3]]);c[1].set_fromConstraintSegments([f[0],f[1]]);c[2].set_fromConstraintSegments([f[1],f[2]]);c[3].set_fromConstraintSegments([f[2],f[3]]);d[0].fromConstraintSegments.push(f[0]);d[1].fromConstraintSegments.push(f[0]);d[2].fromConstraintSegments.push(f[1]);d[3].fromConstraintSegments.push(f[1]);d[4].fromConstraintSegments.push(f[2]);d[5].fromConstraintSegments.push(f[2]);d[6].fromConstraintSegments.push(f[3]);d[7].fromConstraintSegments.push(f[3]);f[0].get_edges().push(d[0]);f[1].get_edges().push(d[2]);
f[2].get_edges().push(d[4]);f[3].get_edges().push(d[6]);f[0].fromShape=h;f[1].fromShape=h;f[2].fromShape=h;f[3].fromShape=h;h.segments=f;f=new DDLS.Mesh(a,b);f._vertices=c;f._edges=d;f._faces=e;f.get___constraintShapes().push(h);c=[0,0,a,0,a,0,a,b,a,b,0,b,0,b,0,0];f.set_clipping(!1);f.insertConstraintShape(c);f.set_clipping(!0);return f};DDLS.BitmapObject={};
DDLS.BitmapObject.buildFromBmpData=function(a,b,c,d){null==b&&(b=1);DDLS.Debug.assertTrue(0<a.width&&0<a.height,"Invalid `bmpData` size ("+a.width+", "+a.height+")",{fileName:"BitmapObject.js",lineNumber:24,className:"DDLS.BitmapObject",methodName:"buildFromBmpData"});a=DDLS.Potrace.buildShapes(a,c,d);if(1<=b){c=0;for(var e=a.length;c<e;){var f=c++;a[f]=DDLS.ShapeSimplifier(a[f],b)}}b=[];c=0;for(e=a.length;c<e;)f=c++,b.push(DDLS.Potrace.buildGraph(a[f]));a=[];c=0;for(e=b.length;c<e;)f=c++,a.push(DDLS.Potrace.buildPolygon(b[f],
d));b=new DDLS.Object;c=0;for(e=a.length;c<e;){f=c++;for(d=0;d<a[f].length-2;)b.get_coordinates().push(a[f][d]),b.get_coordinates().push(a[f][d+1]),b.get_coordinates().push(a[f][d+2]),b.get_coordinates().push(a[f][d+3]),d+=2;b.get_coordinates().push(a[f][0]);b.get_coordinates().push(a[f][1]);b.get_coordinates().push(a[f][d]);b.get_coordinates().push(a[f][d+1])}return b};DDLS.BitmapMesh={};
DDLS.BitmapMesh.buildFromBmpData=function(a,b,c,d){null==b&&(b=1);DDLS.Debug.assertTrue(0<a.width&&0<a.height,"Invalid `bmpData` size ("+a.width+", "+a.height+")",{fileName:"BitmapMesh.js",lineNumber:24,className:"DDLS.BitmapMesh",methodName:"buildFromBmpData"});c=DDLS.Potrace.buildShapes(a,c,d);if(1<=b)for(var e=0,f=c.length;e<f;){var h=e++;c[h]=DDLS.ShapeSimplifier(c[h],b)}b=[];e=0;for(f=c.length;e<f;)h=e++,b.push(DDLS.Potrace.buildGraph(c[h]));c=[];e=0;for(f=b.length;e<f;)h=e++,c.push(DDLS.Potrace.buildPolygon(b[h],
d));d=DDLS.RectMesh(a.width,a.height);b=0;for(e=c.length;b<e;){f=b++;for(a=0;a<c[f].length-2;)d.insertConstraintSegment(c[f][a],c[f][a+1],c[f][a+2],c[f][a+3]),a+=2;d.insertConstraintSegment(c[f][a],c[f][a+1],c[f][a+2],c[f][a+3])}return d};DDLS.BasicCanvas=function(a,b,c,d){this.canvas=window.document.createElement("canvas");this.canvas.width=a||200;this.canvas.height=b||200;this.ctx=this.canvas.getContext("2d");this.canvas.style.position="absolute";this.canvas.style.backgroundColor=c||"#000000";this.ctx.fillStyle=c||"#000000";this.image=this.canvas;this.loop(d||60);window.document.body.appendChild(this.canvas)};
DDLS.BasicCanvas.prototype={loop:function(a){window.requestAnimationFrame(DDLS.Bind(this,this.loop));if(null!=this.onEnterFrame)this.onEnterFrame();return!0},clear:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},drawCircle:function(a,b,c){this.ctx.beginPath();this.ctx.arc(a,b,c,0,DDLS.TwoPI,!1);this.ctx.stroke();this.ctx.closePath()},drawRect:function(a,b,c,d){this.ctx.beginPath();this.ctx.moveTo(a,b);this.ctx.lineTo(a+c,b);this.ctx.lineTo(a+c,b+d);this.ctx.lineTo(a,b+d);
this.ctx.stroke();this.ctx.closePath()},lineStyle:function(a,b,c){this.ctx.lineWidth=a;this.ctx.strokeStyle=null!=c&&1!=c?"rgba("+(b>>16&255)+","+(b>>8&255)+","+(b&255)+","+c+")":"#"+DDLS.StringTools.hex(b,6)},moveTo:function(a,b){this.ctx.beginPath();this.ctx.moveTo(a,b)},lineTo:function(a,b){this.ctx.lineTo(a,b);this.ctx.closePath();this.ctx.stroke()},beginFill:function(a,b){this.ctx.fillStyle=null!=b&&1!=b?"rgba("+(a>>16&255)+","+(a>>8&255)+","+(a&255)+","+b+")":"#"+DDLS.StringTools.hex(a,6);this.ctx.beginPath()},
endFill:function(){this.ctx.stroke();this.ctx.closePath();this.ctx.fill()}};DDLS.SimpleView=function(a){this.entitiesAlpha=0.75;this.entitiesWidth=1;this.entitiesColor=65280;this.pathsAlpha=0.75;this.pathsWidth=1.5;this.pathsColor=16760848;this.verticesAlpha=0.25;this.verticesRadius=0.5;this.verticesColor=255;this.constraintsAlpha=1;this.constraintsWidth=2;this.constraintsColor=16711680;this.edgesAlpha=0.25;this.edgesWidth=1;this.edgesColor=10066329;this.graphics=new DDLS.DrawContext(a);this.g=this.graphics.g};
DDLS.SimpleView.prototype={drawVertex:function(a){this.g.lineStyle(this.verticesRadius,this.verticesColor,this.verticesAlpha);this.g.beginFill(this.verticesColor,this.verticesAlpha);this.g.drawCircle(a.get_pos().x,a.get_pos().y,this.verticesRadius);this.g.endFill()},drawEdge:function(a){a.get_isConstrained()?this.g.lineStyle(this.constraintsWidth,this.constraintsColor,this.constraintsAlpha):this.g.lineStyle(this.edgesWidth,this.edgesColor,this.edgesAlpha);this.g.moveTo(a.get_originVertex().get_pos().x,
a.get_originVertex().get_pos().y);this.g.lineTo(a.get_destinationVertex().get_pos().x,a.get_destinationVertex().get_pos().y)},drawMesh:function(a,b){null==b&&(b=!1);b&&this.g.clear();a.traverse(DDLS.Bind(this,this.drawVertex),DDLS.Bind(this,this.drawEdge))},drawEntity:function(a,b){null==b&&(b=!1);b&&this.g.clear();this.g.lineStyle(this.entitiesWidth,this.entitiesColor,this.entitiesAlpha);this.g.beginFill(this.entitiesColor,this.entitiesAlpha);this.g.drawCircle(a.x,a.y,a.get_radius());this.g.endFill()},
drawEntities:function(a,b){null==b&&(b=!1);b&&this.g.clear();for(var c=0,d=a.length;c<d;){var e=c++;this.drawEntity(a[e],!1)}},drawPath:function(a,b){null==b&&(b=!1);b&&this.g.clear();if(0!=a.length){this.g.lineStyle(this.pathsWidth,this.pathsColor,this.pathsAlpha);this.g.moveTo(a[0],a[1]);for(var c=2;c<a.length;)this.g.lineTo(a[c],a[c+1]),this.g.moveTo(a[c],a[c+1]),c+=2}}};DDLS.DrawContext=function(a){this.g=a};
DDLS.DrawContext.prototype={clear:function(){this.g.clear()},lineStyle:function(a,b,c){null==c&&(c=1);this.g.lineStyle(a,b,c)},beginFill:function(a,b){null==b&&(b=1);this.g.beginFill(a,b)},endFill:function(){this.g.endFill()},moveTo:function(a,b){this.g.moveTo(a,b)},lineTo:function(a,b){this.g.lineTo(a,b)},drawCircle:function(a,b,c){this.g.drawCircle(a,b,c)},drawRect:function(a,b,c,d){this.g.drawRect(a,b,c,d)}};DDLS._Pixels={};DDLS._Pixels.Pixels_Impl_=function(){};DDLS._Pixels.Pixels_Impl_._new=function(a,b,c){null==c&&(c=!0);return new DDLS._Pixels.PixelsData(a,b,c)};DDLS._Pixels.Pixels_Impl_.getByte=function(a,b){return a.bytes.b[b]};DDLS._Pixels.Pixels_Impl_.getPixel=function(a,b,c){b=c*a.width+b<<2;return a.bytes.b[b+1]<<16|a.bytes.b[b+2]<<8|a.bytes.b[b+3]};
DDLS._Pixels.Pixels_Impl_.getPixel32=function(a,b,c){b=c*a.width+b<<2;return a.bytes.b[b]<<24|a.bytes.b[b+1]<<16|a.bytes.b[b+2]<<8|a.bytes.b[b+3]};DDLS._Pixels.Pixels_Impl_.setByte=function(a,b,c){a.bytes.b[b]=c&255};DDLS._Pixels.Pixels_Impl_.setPixel=function(a,b,c,d){b=c*a.width+b<<2;a.bytes.b[b+1]=d>>16&255;a.bytes.b[b+2]=d>>8&255;a.bytes.b[b+3]=d&255};
DDLS._Pixels.Pixels_Impl_.setPixel32=function(a,b,c,d){b=c*a.width+b<<2;a.bytes.b[b]=d>>24&255;a.bytes.b[b+1]=d>>16&255;a.bytes.b[b+2]=d>>8&255;a.bytes.b[b+3]=d&255};DDLS._Pixels.Pixels_Impl_.fromImageData=function(a){var b=new DDLS._Pixels.PixelsData(a.width,a.height,!0);a=a.data;for(var c=0,d=a.byteLength;c<d;){var e=c++;b.bytes.b[e]=a[e]&255}return b};
DDLS._Pixels.PixelsData=function(a,b,c){null==c&&(c=!0);this.length=a*b;c&&(this.bytes=DDLS.Bytes.alloc(this.length<<2));this.width=a;this.height=b};DDLS._Pixels.PixelsData.__name__=!0;DDLS.Converter=function(){};DDLS.Converter.__name__=!0;
DDLS.Converter.ARGB2RGBA=function(a,b){if(null!=b)for(var c=0,d=a.length;c<d;){var e=c++;b.b[0!=e%4?e-1:e+3]=a.b[e]&255}else for(b=a,c=0,d=a.length>>2;c<d;){var e=c++<<2,f=a.b[e+1],h=a.b[e+2],g=a.b[e+3];b.b[e+3]=a.b[e]&255;b.b[e]=f&255;b.b[e+1]=h&255;b.b[e+2]=g&255}};
DDLS.Converter.RGBA2ARGB=function(a,b){if(null!=b)for(var c=0,d=a.length;c<d;){var e=c++;b.b[3>=e%4?e+1:e-3]=a.b[e]&255}else for(b=a,c=0,d=a.length>>2;c<d;){var e=c++<<2,f=a.b[e],h=a.b[e+1],g=a.b[e+2];b.b[e]=a.b[e+3]&255;b.b[e+1]=f&255;b.b[e+2]=h&255;b.b[e+3]=g&255}};DDLS.CanvasPixelMatrix=function(a,b,c){this.data=a;this.width=b;this.height=c;this.lookup=[];b=a=0;for(c=this.height;b<c;){var d=b++;this.lookup[d]=[];for(var e=0,f=this.width;e<f;){var h=e++;this.lookup[d][h]=4*a|0;a++}}};
DDLS.CanvasPixelMatrix.createCanvasPixelMatrixFromContext=function(a,b,c){a=a.getImageData(0,0,b,c).data;return new DDLS.CanvasPixelMatrix(a,b,c)};
DDLS.CanvasPixelMatrix.prototype={getPixel32:function(a,b){var c=this.lookup[b][a];return this.data[c+3]<<24|this.data[c]<<16|this.data[c+1]<<8|this.data[c+2]},setPixel32:function(a,b,c){a=this.lookup[b][a];this.data[a+3]=c>>24&255;this.data[a]=c>>16&255;this.data[a+1]=c>>8&255;this.data[a+2]=c&255},setPixel:function(a,b,c){a=this.lookup[b][a];this.data[a]=c>>16&255;this.data[a+1]=c>>8&255;this.data[a+2]=c&255},getPixel:function(a,b){var c=this.lookup[b][a];return this.data[c]<<16|this.data[c+1]<<
8|this.data[c+2]}};DDLS.ImageLoader=function(a,b){this.images=new DDLS.StringMap;this.loaded=b;this.count=a.length;for(var c=0;c<a.length;){var d=a[c];++c;this.load(d)}};
DDLS.ImageLoader.prototype={load:function(a){var b;b=window.document.createElement("img");var c=b.style;c.left="0px";c.top="0px";c.paddingLeft="0px";c.paddingTop="0px";b.onload=function(a,b,c){return function(h){return a(b,c,h)}}(DDLS.Bind(this,this.store),b,a.split("/").pop());c.position="absolute";b.src=a},store:function(a,b,c){this.count--;DDLS.Log("store "+b+" "+this.count,{fileName:"ImageLoader.hx",lineNumber:67,className:"DDLS.ImageLoader",methodName:"store"});this.images.set(b,a);0==this.count&&
this.loaded()}};
